{% extends "base.html" %} {% block title %}PDF-Sistema{% endblock %}

{% block content %}
<div class="container" x-data="main()" x-init="getPDFSistema()">
  <p class="title is-1">PDF-Sistema</p>
  <div class="buttons">
    <a href="/utilidades/planos" class="button is-primary">Planos</a>
    <a href="/utilidades/impresos" class="button is-primary">Impresos</a>
    <a href="/utilidades/contador" class="button is-primary">Contador</a>
    <a href="/utilidades/documentos" class="button is-primary">Documentos</a>
  </div>

  <div class="grid-buscar mb-6 mr-3 mt-2">
    <input type="text" placeholder="Buscar" x-model="buscar" @keyup.enter="restringirBusqueda(buscar)"/>
    <button class="button is-primary" @click="restringirBusqueda(buscar)">Buscar</button>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>Imp</th>
        <th>PDF-Sistema</th>
      </tr>
    </thead>
    <tbody>
      <template x-for="pdf in pdfs">
        <tr>
          <td><button class="button is-danger is-small" @click="imprimirPdfSistema(pdf)">Imprimir</button></td>
          <td x-text="pdf"></td>
        </tr>
      </template>
    </tbody>
  </table>
</div>


{% endblock %} {% block script %}
<script>
 function main(){
     return{
         pdfs:[],
	     pdfs_:[],
	     buscar:'',
         imprimirPdfSistema(pdf){
        	 axios({
          		 method: "GET",
          		 url: "/utilidades/imprimirpdfsistema/"+pdf,
          		 responseType: "blob",
        	 }).then((res) => {
          		 let url = window.URL.createObjectURL(res.data);
          		 window.open(url);
         })},
         getPDFSistema(){
             axios.get('/utilidades/getpdfsistema')
				  .then(res=>{
					  this.pdfs=res.data.pdfs
				      this.pdfs_=this.pdfs
				  })
         },
         restringirBusqueda(buscar){
             this.pdfs = this.pdfs_
             this.pdfs = this.pdfs.filter(row=>row.toLowerCase().includes(buscar.toLowerCase()))
         },
     }
 }

</script>
{% endblock %}
