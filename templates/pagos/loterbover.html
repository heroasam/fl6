{% extends "base.html" %}

{% block title %}Listado de LoteRbos{% endblock %}

{% block content %}

<div class="container" x-data="main()" x-init="getListaLotesRbos()">


   <p class="title is-1">Listado de Lote de Rbos</p>

  <table class="table table-striped nototal" id="table">
    <thead>
      <tr>
        <th>Id</th>
        <th>fecha</th>
        <th>cobr</th>
        <th>cnt</th>
        <th>oper.</th>
        <th>oper.</th>
      </tr>
    </thead>
    <tbody>
      <template x-for="lote in listaLotesRbos">
        <tr>
          <td x-text="lote.id"></td>
          <td x-text="lote.fecha"></td>
          <td x-text="lote.cobr"></td>
          <td x-text="lote.cnt"></td>
          <td><i class="fa fa-print" aria-hidden="true" @click="imprimirLoteRbo(lote.id,lote.fecha,lote.cobr)"></td>
          <td><i class="fa fa-times" aria-hidden="true" @click="borrarLoteRbo(lote.id)"></td>
        </tr>
      </template>
    </tbody>
  </table>

</div>
{% endblock %}
{% block script %}
<script>
 function main(){
     return{
         listaLotesRbos:[],
         getListaLotesRbos(){
             axios.get('/loterbo/getlistalotesrbo')
                  .then(res=>{
                      this.listaLotesRbos = res.data.listalotesrbo
                      this.listaLotesRbos.map(row=>row.fecha=dayjs.utc(row.fecha).format('YYYY-MM-DD'))
                  })
         },
         borrarLoteRbo(id){
            Swal.fire({
            title: 'Â¿Esta seguro?',
            text: `Se borrara el Lote ${id}`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si, borrarlo!'
            }).then((result) => {
            if (result.isConfirmed) {
                axios.get('/loterbo/delete/'+id)
                     .then(res=>{
                         msgSuccess('Borrado!','El lote ha sido borrado')
                         this.getListaLotesRbos()})
                     .catch(error=>msgError('No se pudo borrar. Hubo un error.'))
            }})
         },
         imprimirLoteRbo(id,fecha,cobr){
             axios.get('/loterbo/reimprimir/'+fecha+'/'+cobr+'/'+id, {responseType:"blob"})
                  .then(res=>{
                      let url = window.URL.createObjectURL(res.data);
          		      window.open(url);
                  })
         },
     }
 }
</script>
{% endblock %}
