{% extends "base.html" %}

{% block title %}Retiros Socios{% endblock %}

{% block content %}

<div class="container">

 <p class="title is-1">Retiro Socios</p>
<div  x-data="main()" x-init="getGrafico();getGraficoPie()">
  <div class="columns">
    <div class="column is-10">
        {{tbl|safe}}
    </div>
  </div>
  <div class="columns">
    <div class="column is-6">
      <div class="box">
        <canvas id="grafico-estadistica" width="400" height="200"></canvas>
      </div>
    </div>
    <div class="column is-4">
      <div class="box">
        <canvas id="grafico-estadistica1" width="200" height="200"></canvas>
      </div>
    </div>
  </div>
</div>
</div>
{% endblock %}

{% block script %}
<script>
 const table = document.getElementById('retiros')
 const thead = table.querySelector('thead')
 const tr = thead.children
 const ths = tr[0].children
 ths[5].innerText = "Bancos"
 ths[6].innerText = "Efectivo"
 ths[7].innerText = "Total"
 const tbody = table.querySelector('tbody')
 const arrayRows = Array.from(tbody.rows)
 arrayRows.forEach(row=>{
     if(row.rowIndex>3){
         row.cells[5].innerText=""
         row.cells[6].innerText=""
         row.cells[7].innerText=""
     }
 })
 function main(){
     return{
         totfede:'',
         totpapi:'',
         totalfede:'',
         totalpapi:'',
         retirosocios:'',
         index:'',
         getGrafico(){
             this.totfede = {{totfede|tojson}}
             this.totpapi = {{totpapi|tojson}}
             this.index = {{index|tojson}}
             this.totfede = this.totfede.map(el=>Math.abs(el))
             this.totpapi = this.totpapi.map(el=>Math.abs(el))
             this.totalfede = this.totfede.map(a=>Number.isNaN(a)?0:a).reduce((a,b)=>(a+b))
             this.totalpapi = this.totpapi.map(a=>Number.isNaN(a)?0:a).reduce((a,b)=>(a+b))
             totalretiros = this.totalfede + this.totalpapi
             this.retirosocios = [this.totalfede/totalretiros*100, this.totalpapi/totalretiros*100]

             const canvas = document.getElementById('grafico-estadistica').getContext('2d');
             const labels = this.index;
             const data = {
                 labels: labels,
                 datasets: [
                     {
                         label: 'papi',
                         data: this.totpapi,
                         borderColor: '#2596be',
                     },
                     {
                         label: 'fede',
                         data: this.totfede,
                         borderColor: '#9925be',
                     },
                 ]
             };
                          const chart = new Chart(canvas, {
                     type: 'line',
                     data: data,
                     options: {
                     responsive: true,
                     plugins: {
                         legend: {
                             position: 'top',
                         },
                         title: {
                             display: true,
                             text: 'Retiros Socios'
                         }
                     }
                     },
                          });

         },
         getGraficoPie(){
             const canvas = document.getElementById('grafico-estadistica1').getContext('2d');
             this.chart = new Chart(canvas, {
                 type: 'doughnut',
                 data: {
                     labels: [
                         '% Papi',
                         '% Fede',
                     ],
                     datasets: [{
                         label: 'Porcentaje Retiro Socios',
                         data: this.retirosocios,
                         backgroundColor: [
                             'rgb(255, 205, 86)',
                             'rgb(66, 135, 245)',
                         ],
                         hoverOffset: 2
                     }]
                 }
             })
         },

 }


 }
</script>
{% endblock %}
