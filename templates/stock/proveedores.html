{% extends "base_template.html" %}

{% block title %}Proveedores{% endblock %}

{% block content %}

<div x-data="main()" class="container" x-init="getProveedores()">
<div class="columns">
    <div class="column is-7">
        <h1 style="width:70%;" class="title is-size-1">Proveedores</h1>
    </div>
</div>
<div class="block">
    <a href="/stock/asientos"  type="button" class="button is-primary">Asientos</a>
    <a href="/stock/mayor"  type="button" class="button is-primary">Mayor</a>
    <a href="/stock/pivotcuentas"  type="button" class="button is-primary">Pivot-Cuentas</a>
    <a href="/stock/retiros"  type="button" class="button is-primary">Retiros</a>
    <a href="/stock/compras"  type="button" class="button is-primary">Compras</a>
    <a href="/stock/salidas"  type="button" class="button is-primary">Salidas</a>
    <a href="/stock/articulos"  type="button" class="button is-primary">Articulos</a>
    <a href="/stock/verstock"  type="button" class="button is-primary">Stock</a>
    <a href="/stock/cuentas"  type="button" class="button is-primary">Cuentas</a>
</div>

<button class="button is-success mb-3" @click="Proveedor={};agregarProveedor()">Agregar Proveedor</button>
<table class="table" id="table">
    <thead>
        <tr>
            <th>Borrar</th>
            <th>Editar</th>
            <th>id</th>
            <th>Empresa</th>
            <th>Direccion</th>
            <th>Whatsapp</th>
            <th>Alias</th>
            <th>CBU</th>
            <th>Contacto</th>
            <th>Transporte</th>
            <th>Descripcion</th>
        </tr>
    </thead>
    <tbody>
        <template x-for="item in listProveedores">
                <tr>
                <td><button class="button is-danger is-small" @click="borrarProveedor(item.id)">Borrar</button></td>
                <td><button class="button is-info is-small" @click="Proveedor=item;editarProveedor()">Editar</button></td>
                <td x-text="item.id"></td>
                <td x-text="item.empresa"></td>
                <td x-text="item.direccion"></td>
                <td x-text="item.wapp"></td>
                <td x-text="item.alias"></td>
                <td x-text="item.cbu"></td>
                <td x-text="item.contacto"></td>
                <td x-text="item.transporte"></td>
                <td x-text="item.descripcion"></td>
                </tr>
            </template>
    </tbody>
</table>
<div x-bind:class="verModalProveedores?'xmodal-container':''">
    <div class="xcard xmodal" x-show="verModalProveedores">
        <div class="flex justify-content-end">
            <button class="btn-close" @click="verModalProveedores=false"><i class="fa fa-times fa-2x" aria-hidden="true"></i></button>
        </div>
        <h1 class="title is-3">Proveedores</h1>
        <input type="text" class="input mb-1" x-model="Proveedor.empresa" placeholder="empresa" style="min-width:400px;">
        <input type="text" class="input mb-1" x-model="Proveedor.direccion" placeholder="direccion">
        <input type="text" class="input mb-1" x-model="Proveedor.wapp" placeholder="whatsapp">
        <input type="text" class="input mb-1" x-model="Proveedor.alias" placeholder="alias">
        <input type="text" class="input mb-1" x-model="Proveedor.cbu" placeholder="CBU">
        <input type="text" class="input mb-1" x-model="Proveedor.contacto" placeholder="contacto">
        <input type="text" class="input mb-1" x-model="Proveedor.transporte" placeholder="transporte">
        <input type="text" class="input mb-1" x-model="Proveedor.descripcion" placeholder="descripcion">
        <button class="button is-primary" @click="guardarRegistro">Guardar</button>
        <input type="hidden" name="csrf_token" x-ref="token" value="{{ csrf_token() }}"/>
    </div>
</div>



</div>
{% endblock %}
{% block script %}
<script>
function main(){
    return {
        listProveedores:[],
        verModalProveedores:false,
        Proveedor:{},
        borrarProveedor(id){

        },
        editProveedor(id){

        },
        getProveedores(){
            axios.get('/stock/getproveedores')
            .then(res=>{
                this.listProveedores = res.data.proveedores
            })
        },
        agregarProveedor(){
            this.verModalProveedores=true;
        },
        editarProveedor(){
            this.verModalProveedores=true;
        },
        guardarRegistro(){
            // agregar o editar registro
            this.verModalProveedores=false;
            if(this.Proveedor.id == null){
                url = '/stock/agregarproveedor'
            }else{
                url='/stock/editarproveedor'
            }
            axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
            axios({
                method:'POST',
                data: this.Proveedor,
                url: url,
            })
            .then(res=>{
                Swal.fire({
                                            title: 'Proveedor',
                                            text: 'Registro Guardado',
                                            icon: 'success',
                                            timer: 3000,
                                            });
            this.getProveedores() 
            })
        },
        borrarProveedor(id){
            Swal.fire({
            title: 'Â¿Esta seguro?',
            text: "El borrado es irreversible!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si, borrarlo!'
            }).then((result) => {
            if (result.isConfirmed) {
                axios.get('/stock/borrarproveedor/'+id)
                .then(res=>{
                    Swal.fire(
                    'Borrado!',
                    'El registro ha sido borrado.',
                    'success'
                    )
                    this.getProveedores()
                })
            }})
        },
    }
}

</script>
{% endblock %}
