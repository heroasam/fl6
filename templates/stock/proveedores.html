{% extends "base.html" %}

{% block title %}Proveedores{% endblock %}

{% block content %}

<div x-data="main()" class="container" x-init="getProveedores()">
  <!-- <div class="block">
       <a href="/stock/asientos"  type="button" class="button is-primary">Asientos</a>
       <a href="/stock/mayor"  type="button" class="button is-primary">Mayor</a>
       <a href="/stock/pivotcuentas"  type="button" class="button is-primary">Pivot-Cuentas</a>
       <a href="/stock/retiros"  type="button" class="button is-primary">Retiros</a>
       <a href="/stock/compras"  type="button" class="button is-primary">Compras</a>
       <a href="/stock/salidas"  type="button" class="button is-primary">Salidas</a>
       <a href="/stock/articulos"  type="button" class="button is-primary">Articulos</a>
       <a href="/stock/verstock"  type="button" class="button is-primary">Stock</a>
       <a href="/stock/cuentas"  type="button" class="button is-primary">Cuentas</a>
       <a href="/stock/cuadro"  type="button" class="button is-primary">Cuadro</a>
       </div> -->
  <div class="columns">
    <div class="column is-7">
      <h1 style="width:70%;" class="title is-size-1">Proveedores</h1>
    </div>
  </div>

  <button class="button is-primary mb-3 block" @click="Proveedor={};agregarProveedor()">Agregar Proveedor</button>
  <table class="table nototal" id="table">
    <thead>
      <tr>
        <th>Borrar</th>
        <th>Editar</th>
        <th>id</th>
        <th>Empresa</th>
        <th>Direccion</th>
        <th>Whatsapp</th>
        <th>Alias</th>
        <th>CBU</th>
        <th>Contacto</th>
        <th>Transporte</th>
        <th>Descripcion</th>
      </tr>
    </thead>
    <tbody>
      <template x-for="item in listProveedores">
        <tr>
          <td><i class="fa fa-times" aria-hidden="true" @click="borrarProveedor(item.id)"></td>
            <td><i class="fa fa-pencil" aria-hidden="true" @click="Proveedor=item; editarProveedor()"></td>
              <td x-text="item.id"></td>
              <td x-text="item.empresa"></td>
              <td x-text="item.direccion"></td>
              <td x-text="item.wapp"></td>
              <td x-text="item.alias"></td>
              <td x-text="item.cbu"></td>
              <td x-text="item.contacto"></td>
              <td x-text="item.transporte"></td>
              <td x-text="item.descripcion"></td>
        </tr>
      </template>
    </tbody>
  </table>

  <!-- modal bulma -->
  <input type="hidden" name="csrf_token" x-ref="token" value="{{ csrf_token() }}"/>
  <div class="modal" id="modal-add">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Agregar Proveedor</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-add')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <label for="empresa">Empresa</label>
        <input type="text" class="input mb-1" x-model="Proveedor.empresa" id="empresa" style="min-width:400px;">
        <label for="direccion">Direccion</label>
        <input type="text" class="input mb-1" x-model="Proveedor.direccion" id="direccion">
        <label for="wapp">Whatsapp</label>
        <input type="text" class="input mb-1" x-model="Proveedor.wapp" id="wapp">
        <label for="alias">Alias</label>
        <input type="text" class="input mb-1" x-model="Proveedor.alias" id="alias">
        <label for="cbu">CBU</label>
        <input type="text" class="input mb-1" x-model="Proveedor.cbu" id="cbu">
        <label for="contacto">Contacto</label>
        <input type="text" class="input mb-1" x-model="Proveedor.contacto" id="contacto">
        <label for="transporte">Transporte</label>
        <input type="text" class="input mb-1" x-model="Proveedor.transporte" id="transporte">
        <label for="descripcion">Descripcion</label>
        <input type="text" class="input mb-1" x-model="Proveedor.descripcion" id="descripcion">
      </section>
      <footer class="modal-card-foot">
        <button class="button is-success" @click="guardarRegistro()">Agregar</button>
        <button class="button" @click="toggleModal('modal-add')">Cancelar</button>
      </footer>
    </div>
  </div>



</div>
{% endblock %}
{% block script %}
<script>
 function main(){
     return {
         listProveedores:[],
         Proveedor:{},
         borrarProveedor(id){
         },
         editProveedor(id){
         },
         getProveedores(){
             axios.get('/stock/getproveedores')
                  .then(res=>{
                      this.listProveedores = res.data.proveedores
                  })
         },
         agregarProveedor(){
             toggleModal('modal-add')
         },
         editarProveedor(){
             toggleModal('modal-add')
         },
         guardarRegistro(){
             // agregar o editar registro
             this.verModalProveedores=false;
             if(this.Proveedor.id == null){
                 url = '/stock/agregarproveedor'
             }else{
                 url='/stock/editarproveedor'
             }
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post(url,this.Proveedor)
                                                                 .then(res=>{
                                                                     toggleModal('modal-add')
                                                                     msgSuccess('Proveedor Guardado')
                                                                     this.getProveedores()
                                                                 })
         },
         borrarProveedor(id){
             Swal.fire({
                 title: '¿Esta seguro?',
                 text: `Esta borrando proveedor Nº${id}`,
                 icon: 'warning',
                 showCancelButton: true,
                 confirmButtonColor: '#3085d6',
                 cancelButtonColor: '#d33',
                 confirmButtonText: 'Si, borrarlo!'
             }).then((result) => {
                 if (result.isConfirmed) {
                     axios.get('/stock/borrarproveedor/'+id)
                          .then(res=>{
                              Swal.fire(
                                  'Borrado!',
                                  'El proveedor ha sido borrado.',
                                  'success'
                              )
                              this.getProveedores()
                          })
             }})
         },
     }
 }

</script>
{% endblock %}
