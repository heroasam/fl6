{% extends "base.html" %}

{% block title %}Cuentas{% endblock %}

{% block content %}

<div x-data="main()" class="container" x-init="getCuentas()">
<div class="columns">
    <div class="column is-7">
        <h1 style="width:70%;" class="title is-size-1">Cuentas</h1>
    </div>
</div>
<div class="block">
    <a href="/stock/asientos"  type="button" class="button is-primary">Asientos</a>
    <a href="/stock/mayor"  type="button" class="button is-primary">Mayor</a>
    <a href="/stock/pivotcuentas"  type="button" class="button is-primary">Pivot-Cuentas</a>
    <a href="/stock/retiros"  type="button" class="button is-primary">Retiros</a>
    <a href="/stock/compras"  type="button" class="button is-primary">Compras</a>
    <a href="/stock/salidas"  type="button" class="button is-primary">Salidas</a>
    <a href="/stock/articulos"  type="button" class="button is-primary">Articulos</a>
    <a href="/stock/verstock"  type="button" class="button is-primary">Stock</a>
    <a href="/stock/proveedores"  type="button" class="button
        is-primary">Proveedores</a>
</div>

<button class="button mb-3"
    @click="Cuenta={};agregarCuenta()">Agregar Cuenta</button>
<table class="table" id="table">
    <thead>
        <tr>
            <th>op</th>
            <th>op</th>
            <th>id</th>
            <th>cuenta</th>
            <th>tipo</th>
        </tr>
    </thead>
    <tbody>
        <template x-for="item in listCuentas">
                <tr>
                <td><i class="fa fa-times" aria-hidden="true" @click="borrarCuenta(item.id)"></td>
                <td><i class="fa fa-pencil" aria-hidden="true" @click="editarCuenta(item.id)"></td>
                <td x-text="item.id"></td>
                <td x-text="item.cuenta"></td>
                <td x-text="item.tipo"></td>
                </tr>
            </template>
    </tbody>
</table>
<div x-bind:class="verModalCuenta?'xmodal-container':''">
    <div class="xcard xmodal" x-show="verModalCuenta">
        <div class="flex justify-content-end">
            <button class="btn-close" @click="verModalCuenta=false"><i class="fa fa-times fa-2x" aria-hidden="true"></i></button>
        <h1 class="title is-3">Cuenta</h1>
        <input type="text" class="input mb-1" x-model="Cuenta.cuenta"
        placeholder="cuenta" style="min-width:400px;">
        <input type="text" class="input mb-1" x-model="Cuenta.tipo"
        placeholder="tipo">
        <button class="button is-primary" @click="guardarRegistro">Guardar</button>
        <input type="hidden" name="csrf_token" x-ref="token" value="{{ csrf_token() }}"/>
    </div>
</div>



</div>
{% endblock %}
{% block script %}
<script>
function main(){
    return {
        listCuentas:[],
        verModalCuenta:false,
        Cuenta:{},
        getCuentas(){
            axios.get('/stock/getdictcuentas')
            .then(res=>{
                this.listCuentas = res.data.cuentas
            })
        },
        agregarCuenta(){
            this.verModalCuenta=true;
        },
        editarCuenta(id){
            this.verModalCuenta=true;
	    this.Cuenta = this.listCuentas.filter(row=>row.id==id)[0]
	},
	guardarEdicion(){
            axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
            axios.post('/stock/editarcuenta',this.Cuenta)
	    .then(res=>{
		msgSuccess('Cuenta', 'Registro Editado')
		this.getCuentas()
		this.verModalCuenta=false;
	    })
        },
        guardarRegistro(){
            this.verModalCuenta=false;
            axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
            axios.post('/stock/agregarcuenta',this.Cuenta)
	    .then(res=>{
		msgSuccess('Cuenta', 'Registro Guardado')
		this.getCuentas()
	    })
        },
        borrarCuenta(id){
	    this.Cuenta = this.listCuentas.filter(row=>row.id==id)[0]
            Swal.fire({
            title: 'Â¿Esta seguro?',
            text: `afecta a la cuenta ${this.Cuenta.cuenta}`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si, borrarlo!'
            }).then((result) => {
            if (result.isConfirmed) {
                axios.get('/stock/borrarcuenta/'+id)
                .then(res=>msgSuccess('Borrado!','El registro ha sido borrado'))
		.catch(error=>msgError('Error!','No se puede borrar porque hay asientos que usan esta cuenta'))
                    this.getCuentas()
                }})
            }
        }
}

</script>
{% endblock %}
