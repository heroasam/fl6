{% extends "base_template.html" %}

{% block title %}tabla Articulos{% endblock %}
{% block style %}
<style>
.inactive{
  background-color:rgb(178, 42, 32);
}
.active{
  background-color:rgb(13, 130, 148);
}
.block:not(:last-child) {
    margin-bottom: 1.5rem;
}
.color1 {
    background-color: rgb(178, 42, 32);
    color: black;
    text-align: center;
}
.color2 {
    background-color: rgb(178, 127, 32);
    color: black;
    text-align: center;
}
.color3 {
    background-color: rgb(176, 178, 32);
    color: black;
    text-align: center;
}
.color4 {
    background-color: rgb(32, 178, 98);
    color: black;
    text-align: center;
}
.color5 {
    background-color: rgb(147, 196, 193);
    color: black;
    text-align: center;
}
.color6 {
    background-color: orange;
    color: black;
    text-align: center;
}
.color7 {
    background-color: rgb(80, 89, 214);
    color: black;
    text-align: center;
}
.color8 {
    background-color: rgb(13, 130, 148);
    color: black;
    text-align: center;
}
.color9 {
    background-color: rgb(141, 11, 104);
    color: black;
    text-align: center;
}
.color0 {
    background-color: rgb(127, 19, 189);
    color: black;
    text-align: center;
}
</style>
{% endblock %}

{% block content %}

<div id="app" class="container is-fullhd">
<p class="title is-1">tabla Articulos</p>


<div class="block">
    <a href="/stock/asientos"  type="button" class="button is-outlined is-primary">Asientos</a>
    <a href="/stock/mayor"  type="button" class="button is-outlined is-primary">Mayor</a>
    <a href="/stock/pivotcuentas"  type="button" class="button is-outlined is-primary">Pivot-Cuentas</a>
    <a href="/stock/retiros"  type="button" class="button is-outlined is-primary">Retiros</a>
    <a href="/stock/compras"  type="button" class="button is-outlined is-primary">Compras</a>
    <a href="/stock/salidas"  type="button" class="button is-outlined is-primary">Salidas</a>
    <a href="/stock/verstock"  type="button" class="button is-outlined is-primary">Stock</a>
</div>
<div class="block">
        <div class="field is-horizontal">

            <div class="control">
              <input type="text" v-model="art" class="input" :class='{"is-danger":!art}' placeholder="Articulo" @keyup.enter="$refs.costo.focus()" size="25" ref="art">
              <p v-show="!art" class="help is-danger">Requerido</p>
            </div>
            <div class="control">
                <input type="text" v-model="costo" class="input" size="5" placeholder="Costo" ref="costo" @keyup.enter="$refs.activo.focus()" :class='{"is-danger":!costo}'>
                <p v-show="!costo" class="help is-danger">Requerido</p>
            </div>
            <div class="control">
              <input type="text" v-model="activo" class="input" size="5" placeholder="Activo" ref="activo" @keyup.enter="$refs.guardar.focus()" :class='{"is-danger":!activo}'>
                <p v-show="!activo" class="help is-danger">Requerido</p>
            </div>

            <div class="control">
                <button type="button" class="button is-primary" @click="validarArticulo" ref="guardar" id="guardar">Guardar</button>
            </div>
        </div>
</div>
<div class="columns">
<div class="column is-7">
  <table id="table" class="table is-narrow" id="table">
      <thead>
          <tr>
              <th>op</th>
              <th>op</th>
              <th>id</th>
              <th>art</th>
              <th>costo</th>
              <th>activo</th>
              <th>op</th>
          </tr>
      </thead>
      <tbody>
          <tr v-for="articulo in articulos">
              <td><button class="button is-danger is-small" @click="borrarArticulo(articulo[0])">Borrar</button></td>
              <td><button class="button is-info is-small" @click="editarArticulo(articulo[0],articulo[1],articulo[2],articulo[3])">Editar</button></td>
              <td>|articulo[0]|</td>
              <td>|articulo[1]|</td>
              <td>|articulo[2]|</td>
              <td :class="articulo[3]==1?'active':'inactive'">|articulo[3]|</td>
              <td><button type="button" class="button is-info is-small" @click="toggleactivo(articulo[0])">Toggle</button></td>
          </tr>
      </tbody>
  </table>

</div>

</div>


<div class="modal" :class="{'is-active':toggleModal}">
<div class="modal-background"></div>
<div class="modal-content">
  <div class="block">
          <div class="field is-horizontal">

              <div class="control">
                <input type="text" v-model="arted" class="input" :class='{"is-danger":!arted}' placeholder="Articulo" @keyup.enter="$refs.costoed.focus()" size="25" ref="arted">
                <p v-show="!arted" class="help is-danger">Requerido</p>
              </div>
              <div class="control">
                  <input type="text" v-model="costoed" class="input" size="5" placeholder="Costo" ref="costoed" @keyup.enter="$refs.activoed.focus()" :class='{"is-danger":!costoed}'>
                  <p v-show="!costoed" class="help is-danger">Requerido</p>
              </div>
              <div class="control">
                <input type="text" v-model="activoed" class="input" size="5" placeholder="Activo" ref="activoed" @keyup.enter="$refs.guardar.focus()" :class='{"is-danger":activoed==""}'>
                  <p v-show="activoed==''" class="help is-danger">Requerido</p>
              </div>

              <div class="control">
                  <button type="button" class="button is-primary" @click="validarEdicion()" ref="guardar" id="guardar">Guardar</button>
              </div>
          </div>
  </div>
</div>
<button class="modal-close is-large" aria-label="close" @click="modal"></button>
</div>

</div>
{% endblock %}
{% block script %}
<script>

const app = new Vue({
    el:"#app",
    delimiters:['|','|'],
    data:{
        articulos:[],
        art:'',
        costo:'',
        activo:'',
        ided:'',
        arted:'',
        costoed:'',
        activoed:'',
        toggleModal: false,
    },
    methods: {
        getArticulos(){
            axios.get('/stock/getlistaarticulos')
            .then(res=>{
                this.articulos = res.data.articulos
                //console.log(this.articulos);
            })
        },

        borrarArticulo(id){
            axios.get('/stock/deletearticulo/'+id)
            .then(res=>{
                console.log(res)
                this.getArticulos()
            })
        },
        validarArticulo(){
            if(this.art!=''&&this.activo!=''&&this.costo!=''){
                this.guardarArticulo()
            }else{
                bulmaToast.toast({ message: 'Complete los datos faltantes', type: 'is-danger' })
            }
        },
        guardarArticulo(){
            axios({
                method:'POST',
                url: '/stock/guardararticulo',
                data:{
                    art:this.art,
                    costo: this.costo,
                    activo: this.activo,
                }
            })
            .then(res=>{
                //console.log(res)
                this.getArticulos()
                this.art=''
                this.costo=''
                this.activo=''
                this.$refs.art.focus();
                bulmaToast.toast({message:"Compra procesada con exito", type:'is-success'})
            })
        },
        toggleactivo(id){
          axios.get('/stock/articulotoggleactivo/'+id)
          .then(res=>{
            this.getArticulos()
            //console.log(res)
          })
        },
        editarArticulo(id,art,costo,activo){
          this.modal()
          this.ided=id;
          this.arted=art;
          this.costoed=costo;
          this.activoed=activo;
        },
        validarEdicion(){
            if(this.arted!=''&&this.activoed!=''&&this.costoed!=''){
                this.guardarEdicion()
            }else{
                bulmaToast.toast({ message: 'Complete los datos faltantes', type: 'is-danger' })
            }
        },
        guardarEdicion(){
          axios({
              method:'POST',
              url: '/stock/guardaredicionarticulo',
              data:{
                  ided:this.ided,
                  arted:this.arted,
                  costoed: this.costoed,
                  activoed: this.activoed,
              }
          })
          .then(res=>{
            this.modal()
            this.getArticulos()
          })
        },
        modal(){
          this.toggleModal=!this.toggleModal
        },



    },
    created: function(){
        this.getArticulos();

    },
})


</script>
{% endblock %}
