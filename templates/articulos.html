{% extends "base_template.html" %}

{% block title %}Salida Mercaderia{% endblock %}
{% block style %}
<style>
.block:not(:last-child) {
    margin-bottom: 1.5rem;
}
.color1 {
    background-color: rgb(178, 42, 32);
    color: black;
    text-align: center;
}
.color2 {
    background-color: rgb(178, 127, 32);
    color: black;
    text-align: center;
}
.color3 {
    background-color: rgb(176, 178, 32);
    color: black;
    text-align: center;
}
.color4 {
    background-color: rgb(32, 178, 98);
    color: black;
    text-align: center;
}
.color5 {
    background-color: rgb(147, 196, 193);
    color: black;
    text-align: center;
}
.color6 {
    background-color: orange;
    color: black;
    text-align: center;
}
.color7 {
    background-color: rgb(80, 89, 214);
    color: black;
    text-align: center;
}
.color8 {
    background-color: rgb(13, 130, 148);
    color: black;
    text-align: center;
}
.color9 {
    background-color: rgb(141, 11, 104);
    color: black;
    text-align: center;
}
.color0 {
    background-color: rgb(127, 19, 189);
    color: black;
    text-align: center;
}
</style>
{% endblock %}

{% block content %}

<div id="app" class="container is-fullhd">
<div class="columns">
    <div class="column is-7">
        <p class="title is-1">Salida Mercaderia</p>
    </div>
</div>
<div class="block">
    <a href="/stock/asientos"  type="button" class="button is-outlined is-primary">Asientos</a>
    <a href="/stock/mayor"  type="button" class="button is-outlined is-primary">Mayor</a>
    <a href="/stock/pivotcuentas"  type="button" class="button is-outlined is-primary">Pivot-Cuentas</a>
    <a href="/stock/retiros"  type="button" class="button is-outlined is-primary">Retiros</a>
    <a href="/stock/compras"  type="button" class="button is-outlined is-primary">Compras</a>
    <a href="/stock/salidas"  type="button" class="button is-outlined is-primary">Salidas</a>
    <a href="/stock/verstock"  type="button" class="button is-outlined is-primary">Stock</a>
</div>
<div class="block">
        <div class="field is-horizontal">

            <div class="control">
              <input type="text" v-model="art" class="input" :class='{"is-danger":!art}' placeholder="Articulo" @keyup.enter="$refs.costo.focus()" size="25" ref="art">
              <p v-show="!art" class="help is-danger">Requerido</p>
            </div>
            <div class="control">
                <input type="text" v-model="costo" class="input" size="5" placeholder="Costo" ref="costo" @keyup.enter="$refs.activo.focus()" :class='{"is-danger":!costo}'>
                <p v-show="!costo" class="help is-danger">Requerido</p>
            </div>
            <div class="control">
              <input type="text" v-model="activo" class="input" size="5" placeholder="Activo" ref="activo" @keyup.enter="$refs.guardar.focus()" :class='{"is-danger":!activo}'>
                <p v-show="!activo" class="help is-danger">Requerido</p>
            </div>

            <div class="control">
                <button type="button" class="button is-primary" @click="validarArticulo" ref="guardar" id="guardar">Guardar</button>
            </div>
        </div>
</div>
<div class="columns">
<div class="column is-7">
  <table id="table" class="table is-narrow" id="table">
      <thead>
          <tr>
              <th>op</th>
              <th>id</th>
              <th>art</th>
              <th>costo</th>
              <th>activo</th>
          </tr>
      </thead>
      <tbody>
          <tr v-for="articulo in articulos">
              <td><button class="button is-danger is-small" @click="borrarArticulo(articulo[0])">Borrar</button></td>
              <td>|articulo[0]|</td>
              <td>|articulo[1]|</td>
              <td>|articulo[2]|</td>
              <td>|articulo[3]|</td>
          </tr>
      </tbody>
  </table>

</div>

</div>
</div>


{% endblock %}
{% block script %}
<script>

const app = new Vue({
    el:"#app",
    delimiters:['|','|'],
    data:{
        articulos:[],
        art:'',
        costo:'',
        activo:'',
    },
    methods: {
        getArticulos(){
            axios.get('/stock/getlistaarticulos')
            .then(res=>{
                this.articulos = res.data.articulos
                console.log(this.articulos);
            })
        },

        borrarSalida(id){
            axios.get('/stock/deletesalida/'+id)
            .then(res=>{
                console.log(res)
                this.getSalidas()
            })
        },
        validarArticulo(){
            if(this.fecha!=''&&this.cnt!=''&&this.art!=''&&this.costo!=''){
                this.guardarArticulo()
            }else{
                bulmaToast.toast({ message: 'Complete los datos faltantes', type: 'is-danger' })
            }
        },
        guardarArticulo(){
            axios({
                method:'POST',
                url: '/stock/guardarsalida',
                data:{
                    fecha:this.fecha,
                    cnt: this.cnt,
                    art: this.art,
                    costo: this.costo,
                    comentario: this.comentario,
                }
            })
            .then(res=>{
                //console.log(res)
                this.getSalidas()
                this.cnt=''
                this.art=''
                this.costo=''
                this.comentario=''
                this.$refs.cnt.focus();
                bulmaToast.toast({message:"Compra procesada con exito", type:'is-success'})
            })
        },
        dia(day){
            //formamos el nombre de la clase con la palabra color mas
            //el ultimo digito de los dias para tener solo diez colores
            return "color" + dayjs.utc(day).format('DD').slice(1,2)
        },



    },
    created: function(){
        this.getArticulos();

    },
})


</script>
{% endblock %}
