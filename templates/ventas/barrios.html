{% extends "base_template.html" %}

{% block title %}Barrios{% endblock %}
{% block style %}
<style>
  </style>
  {% endblock %}
  
{% block content %}

<div id="app" class="container">
    <p class="title is-1">Gestion de Barrios</p>
    <div class="buttons">
        <a href="/ventas/pasarventas" class="button is-primary">Pasar Ventas</a>
        <a href="/ventas/listado" class="button is-primary">Listado</a>
        <a href="/ventas/clientes" class="button is-primary">Clientes</a>
        <a href="/ventas/calles" class="button is-primary">Calles</a>
        <a href="/ventas/zonas" class="button is-primary">Zonas</a>
        <a href="/ventas/estadisticas" class="button is-primary">Estadisticas</a>
        <a href="/ventas/morosidad" class="button is-primary">Morosidad</a>
      </div>

      <form class="block field is-horizontal">
          <input type="hidden" name="csrf_token" ref="token" value="{{ csrf_token() }}"/>
          <input type="text" v-model="barrio" class="input is-narrow" style="width: 400px;">
          <button type="button" class="button is-danger" @click="guardarBarrioNuevo">Guardar</button>
      </form>

      <table class="table is-narrow nototal">
          <thead>
              <tr>
                  <th>op</th>
                  <th>op</th>
                  <th>id</th>
                  <th>barrio</th>
              </tr>
          </thead>
          <tbody>
              <tr v-for="barrio in barrios">
                  <td><button type="button" class="button is-danger is-small" @click="borrarBarrio(barrio[0])">Borrar</button></td>
                  <td><button type="button" class="button is-info is-small" @click="editarBarrio(barrio[0],barrio[1])">Editar</button></td>
                  <td>|barrio[0]|</td>
                  <td>|barrio[1]|</td>
              </tr>
          </tbody>
      </table>

      <div class="modal" :class="{'is-active':toggleModal}">
        <div class="modal-background"></div>
        <div class="modal-content">
            <div class="modal-card">
             <section class="modal-card-body">     
                      <input type="hidden" name="csrf_token" ref="token" value="{{ csrf_token() }}"/>
                     
                        <form >
                            <div class="field">
                                <div class="control">
                                    <label class="label" style="color:black;">Barrio</label>
                                    <input type="text" v-model="barrio" class="input is-narrow" :class='{"is-danger":!barrio}'  @keyup.enter="$refs.guardared.focus()"  ref="barrio">
                                    <p v-show="!barrio" class="help is-danger">Requerido</p>
                                  </div>
                            </div>
                            <div class="field">
                                <div class="control">
                                    <button type="button" class="button is-primary" @click="guardarEdicion()" ref="guardared" id="guardar">Guardar</button>
                                </div> 
                            </div> 
                        </form>
                    </section>
        
                      
                      
          
        </div>
        <button class="modal-close is-large" aria-label="close" @click="modal"></button>
        </div>
        </div>

</div>
{% endblock %}

{% block script %}
<script>
  const app = new Vue({
    el:"#app",
    delimiters:['|','|'],
    data:{
        barrios:[],
        id:'',
        barrio:'',
        toggleModal: false,
    },
    methods:{
        getBarrios(){
            axios.get('/ventas/getbarriosconid')
            .then(res=>{
                this.barrios = res.data.barrios
            })

        },
        borrarBarrio(id){
            const borrar = confirm("Â¿Esta seguro que quiere borrar permanentemente esta fila?")
            if(borrar){
                axios.get('/ventas/borrarbarrio/'+id)
                .then(res=>{
                    this.getBarrios()
                    bulmaToast.toast({message:"Borrado procesado con exito", type:'is-success'})
                })
                .catch(error=>{
                    bulmaToast.toast({message:error.request.response, type:'is-danger'})
                })
            }
        },
        editarBarrio(id,barrio){
            this.id = id
            this.barrio = barrio
            this.modal()

        },
        guardarEdicion(){
            axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
          axios({
              method:'POST',
              url: '/ventas/guardaredicionbarrio',
              data:{
                  id:this.id,
                  barrio:this.barrio,
              }
          })
          .then(res=>{
            this.modal()
            this.getBarrios()
            bulmaToast.toast({message:"Edicion procesada con exito", type:'is-success'})
          })
          .catch(error=>{
            //console.log('El error es:',error.request.response)
            bulmaToast.toast({message:error.request.response, type:'is-danger'})
          })
        },
        guardarBarrioNuevo(){
            axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
          axios({
              method:'POST',
              url: '/ventas/guardarbarrionueva',
              data:{
                  barrio:this.barrio,
              }
          })
          .then(res=>{
            this.getBarrios()
            this.barrio=''
            this.id=''
            bulmaToast.toast({message:"Barrio agregada con exito", type:'is-success'})
          })
          .catch(error=>{
            //console.log('El error es:',error.request.response)
            bulmaToast.toast({message:error.request.response, type:'is-danger'})
          })
        },
        modal(){
          this.toggleModal=!this.toggleModal
        },
    },
    created:function(){
        this.getBarrios()
    }
  })
  </script>
  {% endblock %}
