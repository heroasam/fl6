{% extends "base.html" %}

{% block title %}Ver Clientes{% endblock %}
{% block style %}
<style>
</style>
{% endblock %}

{% block content %}

<div class="container" x-data="main()" x-init="getClientes()">
  <div class="buttons">
    <a href="/ventas/ventas" class="button is-primary">Pasar Ventas</a>
    <a href="/ventas/listado" class="button is-primary">Listado</a>
    <a href="/ventas/calles" class="button is-primary">Calles</a>
    <a href="/ventas/barrios" class="button is-primary">Barrios</a>
    <a href="/ventas/zonas" class="button is-primary">Zonas</a>
    <a href="/ventas/estadisticas" class="button is-primary">Estadisticas</a>
	<a href="/ventas/morosidad" class="button is-primary">Morosidad</a>
    <a href="/ventas/devolucion" class="button is-primary">Devoluciones</a>
    <a href="/ventas/pordia" class="button is-primary">Ventas</a>
    <a href="/ventas/pivotdevoluciones" class="button is-primary">Pivot-Devol.</a>
  </div>
  <p class="title is-1">Revision Clientes</p>
  <div class="block">
  <button class="button" @click="getClientes('idvta')">Ver Clientes por idvta</button>
  <button class="button" @click="getClientes('idcliente')">Nuevos Clientes</button>
  </div>

  <table class="table is-narrow nototal">
    <thead>
      <tr>
        <th x-show="idcliente">op</th>
        <th x-show="idcliente">idcliente</th>
        <th x-show="!idcliente">idvta</th>
        <th>nombre</th>
        <th>calle</th>
        <th>num</th>
        <th>zona</th>
        <th>gestion</th>
        <th>mudo</th>
        <th>incobrable</th>
        <th>acla</th>
      </tr>
    </thead>
    <tbody>
      <template x-for="cliente in listaClientes">
        <tr>
          <td x-show="idcliente"><i class="fa fa-times" aria-hidden="true" @click="borrarCliente(cliente.id)"></td>
            <td x-text="cliente.idvta||cliente.id"></td>
          <td x-text="cliente.nombre"></td>
          <td x-text="cliente.calle"></td>
          <td x-text="cliente.num"></td>
          <td x-text="cliente.zona"></td>
          <td><span class="tag is-small is-warning" x-show="cliente.gestion==1">Gestion</span></td>
          <td><span class="tag is-small is-info" x-show="cliente.mudo==1">Mudado</span></td>
          <td><span class="tag is-small is-danger" x-show="cliente.incobrable==1">Incobrable</span></td>
          <td x-text="cliente.acla"></td>
        </tr>
      </template>
    </tbody>
  </table>



</div>
{% endblock %}

{% block script %}
<script>
 function main(){
     return{
         idcliente:false,
         listaClientes:[],
         getClientes(tipo='idvta'){
             axios.get('/ventas/getclientes/'+tipo)
                  .then(res=>{
                      this.listaClientes=res.data.clientes
                      if(tipo=='idcliente'){
                          this.idcliente=true
                      }else{
                          this.idcliente=false
                      }
                  })
         },
         borrarCliente(id){
                         Swal.fire({
            title: 'Â¿Esta seguro?',
            text: `Se borrara el cliente ${id}`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Si, borrarlo!'
            }).then((result) => {
            if (result.isConfirmed) {
                axios.get('/ventas/borrarcliente/'+id)
                     .then(res=>{
                         msgSuccess('Borrado!','El cliente ha sido borrado')
                         this.getClientes('idcliente')})
                     .catch(error=>msgError('No se pudo borrar. Posiblemente el cliente tenga operaciones.'))
            }})
         }
 }}
</script>
{% endblock %}
