{% extends "base.html" %}

{% block title %}Ventas por mes{% endblock %}
{% block style %}
<style>
</style>
{% endblock %}

{% block content %}

<div class="container" x-data="main()" x-init="getGrafico()">

  <p class="title is-1">Ventas por Mes</p>
  <div class="columns">
    <div class="column is-6">
      {{tbl|safe}}
    </div>
    <div class="column is-6">
      <div class="box">
            <canvas id="grafico-estadistica" width="700" height="600"></canvas>
      </div>
    </div>
  </div>


</div>
{% endblock %}

{% block script %}
<script>
 let tableId = document.getElementById('tableventas')
 let tbody = tableId.querySelector('tbody');
 let thead = tableId.querySelector('thead');
 let tr = thead.children[0]
 let ths = tr.children
 for(i=1; i<ths.length;i++){
     ths[i].classList.add('numeric')
 }
 ths[3].innerText = 'Total'
 let rowsArray = Array.from(tbody.rows);
 let rowIndex=[];
 rowsArray.forEach((row)=>{
     rowIndex.push(row.rowIndex-1)
     for(let i=1; i<row.children.length;i++){
         row.cells[i].classList.add('pesos')
     }
 });
 let maxRow = Math.max(...rowIndex)+1;
 let $rowTotal = tbody.insertRow(maxRow);
 let $cell0 = $rowTotal.insertCell(0);
 $cell0.innerHTML = "Total";
 $rowTotal.classList.add('total');

 const cols = rowsArray[0].children.length // determino la cant columnas
 for(let i=1;i<cols;i++){
     let col = [];
     rowIndex.forEach((ix)=>{
         col.push(nop(tbody.rows[ix].cells[i].innerText))
     });
     let total = col.reduce((a,b)=>Number(a)+Number(b));
     let $cell = $rowTotal.insertCell(i);
     if (!(Number.isNaN(total))) $cell.innerHTML = total
     $cell.classList.add('pesos')
 }
 let totales = {{tot|tojson}}
 function main(){
     return{
         getGrafico(){
             const canvas = document.getElementById('grafico-estadistica').getContext('2d');
             const chart = new Chart(canvas, {
                 type: 'bar',
                 data: {
                     labels: [1,2,3,4,5,6,7,8,9,10,11,12],
                     datasets: [{
                        label: 'Monto Vendido por MES',
                        data: totales,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(54, 162, 235, 0.5)',
                            'rgba(255, 206, 86, 0.5)',
                            'rgba(75, 192, 192, 0.5)',
                            'rgba(153, 102, 255, 0.5)',
                            'rgba(255, 159, 64, 0.5)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
          },
     }
 }

</script>
{% endblock %}
