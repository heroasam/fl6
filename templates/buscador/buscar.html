{% extends "base.html" %}

{% block title %}Clientes{% endblock %}
{% block content %}
<div x-data="main()"  class="container" x-init="obtenerCalles();obtenerBarrios();obtenerZonas();obtenerCobradores();
             getInflacion();autoLoad();cargarMsgs()">

  <div>
	<div class="grid-buscar ml-3 mr-3 mt-2" x-show="isMobileDevice">
      <input  placeholder="DNI o NÂ° Cuenta" class="input" x-model="buscar1" @keyup.enter="buscarCliente"
		      @focus="buscar='';verCard=false" type="number" pattern="[0-9]*" inputmode="numeric" :class="darkTheme?'input-dark':''">
      <button type="button" @click="buscarCliente" class="button is-primary">Buscar</button>
	</div>
	<div class="grid-buscar ml-3 mr-3 mt-2 center">
      <input type="search" placeholder="Busca por: Nombre Calle Num aclaracion / DNI / Cuenta / wapp / id9999" class="input" x-model="buscar"
		     @focus="buscar1='';buscar='';verCard=false" @keyup.enter="buscarCliente;$refs.buttonBuscar.focus()" list="busquedasrecientes"
             :class="darkTheme?'input-dark':''" id="idbuscar">
      <datalist id="busquedasrecientes">
        <template x-for="item in listaBusquedasRecientes">
          <option :value="item"></option>
        </template>
      </datalist>
      <button type="button" @click="buscarCliente" class="button is-primary" x-ref="buttonBuscar">Buscar</button>
	</div>
    <div class="grid-buscar ml-3 mr-3 mt-2" x-show="isMobileDevice">
      <input type="text" list="listacalles" class="input mb-1" x-model="calleMostrada"  placeholder="Calle"
             :class="darkTheme?'input-dark':''"/>
      <datalist id="listacalles">
        <template x-for="item in calles">
          <option :value="item"></option>
        </template>
      </datalist>

	  <button type="button" @click="mostrarCalle" class="button is-primary">Mostrar</button>
    </div>
  </div>

  <!-- Tablebuscar -->
  <table class="table tablebuscar noselect is-narrow is-striped mt-6 center" x-show="listaClientes_.length">
	<thead>
	  <tr>
		<th>dni</th>
		<th>nombre</th>
		<th>direccion</th>
		<th>zona</th>
		<th>deuda</th>
		<th>pmovto</th>
		<th>ultpago</th>
		<th>status</th>
	  </tr>
	</thead>
	<tbody>
	  <template x-for="cliente in listaClientes_">
		<tr @click="buscaCuentaporDni(cliente.dni)">
		  <td x-text="cliente.dni"></td>
		  <td x-text="cliente.nombre"></td>
		  <td x-text="cliente.calle+' '+cliente.num"></td>
		  <td x-text="cliente.zona"></td>
		  <td x-text="cliente.deuda"></td>
		  <td x-text="cliente.pmovto"></td>
		  <td x-text="cliente.ultpago"></td>
		  <td style="min-width:300px; text-align:left;">
			<span class="tag is-small is-success"  x-show="cliente.sev">SEVEN</span>
			<span class="tag is-small is-info"  x-show="cliente.subirseven">SUBE</span>
			<span class="tag is-small is-primary"  x-show="cliente.novendermas">LN</span>
			<span class="tag is-small is-warning"  x-show="cliente.gestion">GESTION</span>
			<span class="tag is-small is-info"  x-show="cliente.seguir">SEGUIR</span>
			<span class="tag is-small is-warning"  x-show="cliente.mudo">MUDO</span>
			<span class="tag is-small is-danger"  x-show="cliente.incobrable">INC</span>
			<div class="xtags has-addons m-0" x-show="cliente.devueltas>0">
			  <span class="tag is-small is-warning m-0">devueltas</span>
			  <span class="tag is-small is-light m-0" x-text="cliente.devueltas"></span>
			</div>
			<div class="xtags has-addons m-0" x-show="cliente.deuda>0&&cliente.sev==0&&dayjs.utc().diff(cliente.ultpago,'d')>30&&
				        dayjs(cliente.ultcompra)>dayjs().subtract(1,'y')">
			  <span class="tag is-small is-danger m-0">atrasada</span>
			  <span class="tag is-small is-light m-0" x-text="dayjs().diff(cliente.ultpago,'M')"></span>
			</div>
			<div class="xtags has-addons m-0" x-show="cliente.condonadas>0">
			  <span class="tag is-small is-danger m-0">condonada</span>
			  <span class="tag is-small is-light m-0" x-text="cliente.condonadas"></span>
			</div>
			<div class="xtags has-addons m-0" x-show="cliente.compras>1">
			  <span class="tag is-small is-info m-0">compras</span>
			  <span class="tag is-small is-light m-0" x-text="cliente.compras"></span>
			</div>
			<div class="xtags has-addons m-0" x-show="cliente.compras==0">
			  <span class="tag is-small is-black m-0">compras</span>
			  <span class="tag is-small is-light m-0" x-text="cliente.compras"></span>
			</div>
			<div class="xtags has-addons m-0" x-show="cliente.planes>0">
			  <span class="tag is-small is-warning m-0">planes</span>
			  <span class="tag is-small is-light m-0" x-text="cliente.planes"></span>
			</div>
            <div class="xtags has-addons m-0" x-show="cliente.atraso>0 && cliente.deuda==0">
              <span class="tag is-small is-warning m-0">atrasos</span>
              <span class="tag is-small is-light m-0" x-text="cliente.atraso+' dias'"></span>
            </div>
		  </td>
		</tr>
	  </template>
	</tbody>
  </table>

  <!-- cardclientes -->

  <div class="box mt-6"  x-show="verCard">
	<div>
      <div :class="!isMobileDevice?'flex-baseline-space':''">
        <p class="title title-table is-2" x-text="Cliente.nombre+'  '+Cliente.dni"></p>
        <span class="tag is-small is-success is-light pointer" @click="textToClipboard(Cliente.dni)">Copiar</span>
      <span class="tag is-warning is-small" x-show="verAvisoDniCopiado">DNI copiado al portapapeles</span>
      </div>
      <div class="flex-between">
        <p class="subtitle subtitle-table is-4" x-text="Cliente.calle+' '+Cliente.num+' '+Cliente.barrio+' '+Cliente.zona"></p>
        <a class="button is-black is-small" :href="'https://www.google.com/maps/place/'+Cliente.calle+'+'+Cliente.num+',+C%C3%B3rdoba'">Maps</a>
      </div>
      <p  x-show="Cliente.deuda>0" x-text="'Cobrador asignado: '+Cliente.asignado"></p>
      <p class="subtitle subtitle-table is-4"x-text="'tel:'+Cliente.tel+' wapp:'+Cliente.wapp"></p>

      <p  x-show="Cliente.acla" x-text="Cliente.acla"></p>
      <p  x-show="Cliente.mjecobr" x-text="Cliente.mjecobr"></p>
      <p  x-show="Cliente.horario" x-text="Cliente.horario"></p>
      <p  x-show="Cliente.infoseven" x-text="Cliente.infoseven"></p>
	</div>
    <div class="flex-left">
      <span class="tag is-danger is-small" x-show="Cliente.baja">Ex-SEVEN</span>
      <span class="tag is-danger is-small" x-show="Cliente.novendermas">LN</span>
      <span class="tag is-success is-small" x-show="Cliente.sev">SEVEN</span>
      <span class="tag is-info is-small" x-show="Cliente.subirseven">SUBE</span>
      <span class="tag is-danger is-small" x-show="Cliente.mudo">MUDO</span>
      <span class="tag is-warning is-small" x-show="Cliente.gestion">GESTION</span>
      <span class="tag is-danger is-small" x-show="Cliente.incobrable">INC</span>
      <span class="tag is-info is-small" x-show="Cliente.seguir">SEGUIR</span>
      <span class="tag is-small is-danger pointer"  x-show="Cliente.garantizado"
            @click="open('/buscador/interno/'+Cliente.dnigarante,'_blank')">GARANTE</span>
      <span class="tag is-small is-info pointer"  x-show="Cliente.esgarante"
            @click="document.getElementById('table-garantizados').scrollIntoView({behavior: 'smooth'});">ES GARANTE</span>
    </div>
    <div :class="!isMobileDevice?'flex-baseline-space':'flex-column'">
      <h2 x-text="Cliente.deuda>0?'$'+Cliente.deuda:'SIN DEUDA'" class="title is-2"></h2>
      <h2 x-text="Cliente.pmovto=='Invalid Date'?'':Cliente.pmovto" class="title is-2 pointer" x-show="Cliente.deuda"
	      @click="fecharPmovto(Cliente.id)"></h2>
      <a href="#table-comentarios"
	     x-show="listaComentarios.length">Hay comentarios</a>

      <div>
        <div class="xtags has-addons m0"
		     x-show="Cliente.deuda>0&&dayjs.utc().diff(Cliente.ultpago,'d')>30">
		  <span class="tag is-danger">atrasada</span>
		  <span class="tag is-light" x-text="dayjs.utc().diff(Cliente.ultpago,'M')"></span>
	    </div>
        <div class="xtags has-addons m-0">
		  <span class="tag is-small is-black m-0">cuota maxima</span>
		  <span class="tag is-small is-light m-0" x-text="'$'+cuotaMaxima"></span>
		</div>
	    <div class="xtags has-addons m-0" x-show="Cliente.devueltas>0">
		  <span class="tag is-warning">devueltas</span>
		  <span class="tag is-light" x-text="Cliente.devueltas"></span>
	    </div>
	    <div class="xtags has-addons m-0" x-show="Cliente.condonadas>0">
		  <span class="tag is-small is-danger m-0">condonada</span>
		  <span class="tag is-small is-light m-0" x-text="Cliente.condonadas"></span>
	    </div>
	    <div class="xtags has-addons m-0" x-show="Cliente.compras>1">
		  <a href="#ventas-canceladas" class="tag is-small is-info m-0">compras</a>
		  <span class="tag is-small is-light m-0" x-text="Cliente.compras"></span>
	    </div>
	    <div class="xtags has-addons m-0" x-show="Cliente.compras==0">
		  <span class="tag is-small is-black m-0">compras</span>
		  <span class="tag is-small is-light m-0" x-text="Cliente.compras"></span>
	    </div>
	    <div class="xtags has-addons m-0" x-show="Cliente.planes>0">
		  <span class="tag is-small is-warning m-0">planes</span>
		  <span class="tag is-small is-light m-0" x-text="Cliente.planes"></span>
	    </div>
	    <div class="xtags has-addons m-0" x-show="dayjs.utc().diff(Cliente.fechaintimacion,'d')<30">
		  <span class="tag is-small is-success m-0">intimado</span>
		  <span class="tag is-small is-light m-0" x-text="Cliente.fechaintimacion"></span>
	    </div>
	    <div class="xtags has-addons m-0" x-show="Cliente.atraso>0 && Cliente.deuda==0">
		  <span class="tag is-small is-warning m-0">atrasos</span>
		  <span class="tag is-small is-light m-0" x-text="Cliente.atraso+' dias'"></span>
	    </div>
	    <div class="xtags has-addons m-0" x-show="totalCompradoActualizado">
		  <span class="tag is-small is-success m-0">cancelado</span>
		  <span class="tag is-small is-light m-0" x-text="'$'+parseInt(totalCompradoActualizado)"></span>
	    </div>
      </div>
    </div>
  </div>
  <div class="buttons ml-3 mr-3 mb-1" x-show="verCard">
    <button class="button is-secondary is-small" x-show="!Cliente.sev" @click="toggleSube()">SUBE</button>
    <button class="button is-secondary is-small"  @click="toggleInc()">INC</button>
    <button class="button is-secondary is-small"  @click="toggleNvm()">LN</button>
    <button class="button is-secondary is-small"  @click="toggleGestion()">GESTION</button>
    <button class="button is-secondary is-small"  @click="toggleMudo()">MUDO</button>
    <button class="button is-secondary is-small"  @click="toggleSeguir()">SEGUIR</button>
    <button class="button is-primary is-small" @click="dialogoImprimirFicha()">IMPRIMIR</button>
    <button class="button is-success is-small" @click="clipDatos(Cliente.id)">DATOS</button>

    <!-- dropdown Acciones -->
	<div class="dropdown is-hoverable">
	  <div class="dropdown-trigger">
		<button class="button is-primary is-small" aria-haspopup="true" aria-controls="dropdown-menu">
		  <span>Acciones</span><span class="icon is-small"><i class="fa fa-angle-double-down" aria-hidden="true"></i></span>
		</button>
	  </div>
	  <div class="dropdown-menu" id="dropdown-menu" role="menu">
		<div class="dropdown-content">
		  <a href="#" @click="crearDato()" class="dropdown-item">Sacar Dato</a>
		  <a href="#" @click="editarCliente(Cliente.id)" class="dropdown-item">Editar</a>
		  <a href="#" @click="fecharPmovto(Cliente.id)"  class="dropdown-item">Fechar</a>
		  <a href="#" @click="agregarComentario()"  class="dropdown-item">Comentario</a>
		  <a href="#" @click="agregarPlanPago()"  class="dropdown-item">Plan de Pago</a>
		  <a href="#" @click="gestionarBajaSeven()"  class="dropdown-item">Baja en Seven</a>
		</div>
	  </div>
	</div>
    <!-- dropdown WhatsApp -->
	<div class="dropdown is-hoverable">
	  <div class="dropdown-trigger">
		<button class="button is-danger is-small" aria-haspopup="true" aria-controls="dropdown-menu">
		  <span>whatsapp</span><span class="icon is-small"><i class="fa fa-angle-double-down" aria-hidden="true"></i></span>
		</button>
	  </div>
	  <div class="dropdown-menu" id="dropdown-menu" role="menu">
		<div class="dropdown-content">
		  <a href="#" @click="sendMsgVenta(Cliente.wapp)" class="dropdown-item">Vender</a>
		  <a href="#" @click="sendMsgCbu(Cliente.wapp)"  class="dropdown-item">CBU</a>
		  <a href="#" @click="sendMsgRecordatorio(Cliente.wapp)"  class="dropdown-item">Recordatorio transferencia</a>
		  <a href="#" @click="sendIntWhatsapp(Cliente.wapp)"  class="dropdown-item">Intimacion por Whats</a>
		  <a href="#" @click="sendMsgGeneral(Cliente.wapp)"  class="dropdown-item">mensaje General</a>
		</div>
	  </div>
	</div>
    <!-- dropdown Emitir pdf  -->
	<div class="dropdown is-hoverable">
	  <div class="dropdown-trigger">
		<button class="button is-info is-small" aria-haspopup="true" aria-controls="dropdown-menu">
		  <span>Emitir PDF</span><span class="icon is-small"><i class="fa fa-angle-double-down" aria-hidden="true"></i></span>
		</button>
	  </div>
	  <div class="dropdown-menu" id="dropdown-menu" role="menu">
		<div class="dropdown-content">
		  <a href="#" @click="emitirRbo()" class="dropdown-item">Emitir Recibo</a>
		  <a href="#" @click="emitirLibreDeuda(Cliente.dni)"  class="dropdown-item">Emitir Libre Deuda</a>
		  <a href="#" @click="sendIntimacion(Cliente.dni,Cliente.wapp)"  class="dropdown-item">Emitir Intimacion</a>
		</div>
	  </div>
	</div>
    <!-- dropdown programados -->
     <div class="dropdown is-hoverable">
	  <div class="dropdown-trigger">
	    <button class="button is-small is-link" aria-haspopup="true" aria-controls="dropdown-menu">
		  <span>Programados</span><span class="icon is-small"><i class="fa fa-angle-double-down" aria-hidden="true"></i></span>
	    </button>
	  </div>
	  <div class="dropdown-menu" id="dropdown-menu" role="menu">
	    <div class="dropdown-content">

		  <div>
            <template x-for="item in listamsgs">
		      <a href="#" @click="sendMsgProgramado(item.nombre)" class="dropdown-item" x-text="item.nombre"></a>
            </template>
		  </div>
	    </div>
	  </div>
     </div>

    <input type="hidden" name="csrf_token" x-ref="token" value="{{ csrf_token() }}"/>
  </div>

  <!-- tableventas -->
  <table class="table noselect is-narrow is-striped m-3" x-show="verCard && listaVentas.length">
    <thead>
      <tr>
        <th>id</th>
        <th>fecha</th>
        <th>Ant</th>
        <th>plan</th>
        <th>saldo/comprado</th>
        <th>vdor</th>
        <th>cnt/art</th>
		<th></th>
      </tr>
    </thead>
    <tbody>
      <template x-for="venta in listaVentas">
		<tr>
          <td x-text="venta.id"></td>
          <td x-text="venta.fecha" style="min-width: 150px;"></td>
          <td x-text="venta.ant" style="min-width: 40px;"></td>
          <td x-text="venta.cc+' CUO de $'+venta.ic+' '+venta.p" style="min-width: 200px;"></td>
          <td x-text="venta.saldo+'/'+venta.comprado"></td>
          <td x-text="venta.idvdor"></td>
          <td x-text="venta.cnt+'/'+venta.art" x-show="venta.cnt"></td>
          <td x-text="'PLAN DE PAGOS'" x-show="venta.pp" class="tag-danger"></td>
		  <td><button class="button is-primary is-small" @click="condonarVenta(venta.id)">Condonar</button></td>
		</tr>
      </template>
    </tbody>
  </table>


  <div class="columns">
	<!-- tablecuotas -->
    <div class="column is-3">
	  <div class="flex-center" x-show="verCard">
        <span class="tag is-large">Cuotas a Pagar</span>
        <!-- <span class="icon is-small"><i class="fa fa-plus-square-o" aria-hidden="true"></i></span> -->
	  </div>
      <table class="table is-narrow is-striped" x-show="verCard && listaCuotas.length" id="table-cuotas">
        <thead>
          <tr>
            <th>N</th>
            <th>Fecha</th>
            <th class="sumar numeric">Saldo</i></th>
            <th class="sumar numeric">Actual</i></th>
          </tr>
        </thead>
        <tbody>
          <template x-for="cuota in listaCuotas">
            <!-- nc-vto-saldo -->
			<tr x-show="cuota[2]">
              <td x-text="cuota[0]"></td>
              <td x-text="cuota[1]" style="min-width: 100px;"></td>
              <td x-text="cuota[2]" class="pesos" :class="cuota[3]>cuota[2]?'strike':''"></td>
              <td x-text="cuota[3]" class="pesos red" x-show="cuota[3]>cuota[2]"></td>
			</tr>
          </template>
        </tbody>
      </table>
    </div>

	<!-- tablepagadas -->
    <div class="column is-5" x-show="verCard && listaPagadas.length">
	  <div class="flex-baseline">
        <span class="tag is-large">Cuotas Pagadas</span>
		<span class="tag is-small is-dark" x-text="listaPagadas.length" x-show="listaPagadas.length>5"></span>
		<span class="icon is-small"><i class="fa fa-plus-square-o" aria-hidden="true"
		                               @click="verCuotasPagadas=!verCuotasPagadas" x-show="listaPagadas.length>5"></i></span>
	  </div>
      <table class="table is-narrow is-striped" x-bind:class="verCuotasPagadas?'':'table5'" id="table-cuotaspagadas">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Rbo</th>
            <th class="sumar numeric">Imp</th>
            <th class="sumar numeric">Rec</th>
            <th>Cobr</th>
            <th>Cuenta</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="paga in listaPagadas">
			<tr :class="dayjs(Vtos[paga.idvta])<dayjs(paga.fecha)?'cuotavencida':''">
              <td x-text="paga.fecha" style="min-width: 150px;"></td>
              <td x-text="paga.rbo">
                <td x-text="paga.imp" class="pesos"></td>
                <td x-text="paga.rec" class="pesos"></td>
                <td x-text="paga.cobr"></td>
                <td x-text="paga.idvta"></td>
			</tr>
          </template>
        </tbody>
      </table>
    </div>
  </div>
	<!-- tableventascanceladas -->
  <div class="columns">
  <div class="column is-10">
      <div  id="ventas-canceladas">
      <span class="tag is-large" x-show="verCard && listaVentasCanceladas.length">Ventas Canceladas</span>
      <table class="table is-narrow is-striped" x-show="verCard && listaVentasCanceladas.length">
      <thead>
		<tr>
          <th>id</th>
          <th>fecha</th>
          <th>Ant</th>
          <th>plan</th>
          <th class="numeric">monto</th>
          <th class="sumar numeric">actual</th>
          <th>vdor</th>
          <th>cnt/art</th>
          <th>info</th>
		</tr>
      </thead>
      <tbody>
		<template x-for="venta in listaVentasCanceladas">
		  <tr>
			<td data-titulo="cuenta" x-text="venta.id"></td>
			<td data-titulo="fecha vta"x-text="venta.fecha" style="min-width: 100px;"></td>
			<td data-titulo="anticipo" x-text="venta.ant" style="min-width: 40px;"></td>
			<td data-titulo="plan" x-text="venta.cc+' CUO de $'+venta.ic+' '+venta.p" style="min-width: 200px;"></td>
			<td data-titulo="monto" x-text="venta.comprado" class="pesos"></td>
			<td data-titulo="actual" x-text="parseInt(venta.comprado*listaInflacion[dayjs(venta.fecha).format('YYYYM')])?
                             parseInt(venta.comprado*listaInflacion[dayjs(venta.fecha).format('YYYYM')]):venta.comprado"
                class="red pesos" style="min-width:80px;"></td>
			<td data-titulo="vdor" x-text="venta.idvdor"></td>
			<td data-titulo="arts" x-text="venta.cnt+'/'+venta.art"></td>
			<td x-show="venta.pcondo" x-text="'CUENTA INCLUIDA EN UN PLAN DE PAGOS'" class="tag is-small is-info"></td>
			<td x-show="venta.devuelta" x-text="'DEVUELTA'" class="tag is-small is-danger"></td>
			<td>
			  <div class="xtags has-addons m-0" x-show="venta.condonada&&venta.montocondonado/venta.comprado>0.05"
				   @click="condonarVenta(venta.id)">
				<span class="tag is-small is-danger m-0">condonada</span>
				<span class="tag is-small is-light m-0" x-text="parseInt((venta.montocondonado/venta.comprado)*100)+'%'"></span>
			  </div>
			</td>
		  </tr>
		</template>
      </tbody>
    </table>
  </div>
  </div>
  </div>
  <!-- tablecomentarios -->
  <div class="columns">
    <div class="column is-8">
    <span class="tag is-large" x-show="verCard && listaComentarios.length">Comentarios</span>
    <table class="table noselect is-narrow is-striped" x-show="verCard && listaComentarios.length" id="table-comentarios">
      <thead>
        <tr>
          <th></th>
          <th>Fecha</th>
          <th>Comentario</th>
          <th>Anoto</th>
        </tr>
      </thead>
      <tbody>
        <template x-for="comentario in listaComentarios">
          <tr>
            <td><i class="fa fa-times" aria-hidden="true" @click="borrarComentario(comentario.id,comentario.idcliente)"></td>
			  <td  x-text="comentario.fechahora" style="min-width: 100px;"></td>
			<td  x-text="comentario.comentario"></td>
            <td x-text="comentario.ingreso"></td>
          </tr>
		</template>
      </tbody>
    </table>
    </div>
  </div>
  <!-- tablelogcambiodireccion -->
  <div class="columns">
    <div class="column is-10">
    <span class="tag is-large" x-show="verCard && listaLogCambioDireccion.length">Cambios de Direccion</span>
    <table class="table noselect is-narrow is-striped" x-show="verCard && listaLogCambioDireccion.length">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>calle</th>
          <th>num</th>
          <th>wapp</th>
          <th>acla</th>
        </tr>
      </thead>
      <tbody>
        <template x-for="log in listaLogCambioDireccion">
          <tr>
			<td  x-text="log.fecha" style="min-width: 100px;"></td>
			<td  x-text="log.calle"></td>
			<td  x-text="log.num"></td>
			<td  x-text="log.wapp"></td>
			<td  x-text="log.acla"></td>
          </tr>
		</template>
      </tbody>
    </table>
    </div>
  </div>
  <!-- tablegarantizados -->
  <div class="columns">
    <div class="column is-10">
      <span class="tag is-large" x-show="verCard && listaGarantizados.length">Garantizados</span>
      <table class="table noselect is-narrow is-striped" x-show="verCard && listaGarantizados.length" id="table-garantizados">
        <thead>
          <tr>
            <th></th>
            <th>dni</th>
            <th>nombre</th>
            <th>deuda</th>
            <th>ultpago</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="gar in listaGarantizados">
          <tr>
            <td><a :href="'/buscador/interno/'+gar.dni">Ver</a></td>
            <td x-text="gar.dni"></td>
            <td x-text="gar.nombre"></td>
            <td x-text="gar.deuda"></td>
            <td x-text="gar.ultpago"></td>
          </tr>
          </template>
        </tbody>
      </table>
    </div>
  </div>
  <!-- tabla devoluciones -->
  <div class="columns">
    <div class="column is-10">
      <span class="tag is-large" x-show="verCard && listaDevoluciones.length">Devoluciones</span>
      <table class="table noselect is-narrow is-striped" x-show="verCard && listaDevoluciones.length" id="table-devoluciones">
        <thead>
          <tr>
            <th>fechadev</th>
            <th>totparc</th>
            <th>idvta</th>
            <th>log</th>
            <th>cobr</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="item in listaDevoluciones">
          <tr>
            <td x-text="item.fechadev"></td>
            <td x-text="item.totparc"></td>
            <td x-text="item.idvta"></td>
            <td x-text="item.log"></td>
            <td x-text="item.cobr"></td>
          </tr>
          </template>
        </tbody>
      </table>
    </div>
  </div>
  <!-- tabla visitas -->
   <div class="columns">
    <div class="column is-10">
      <span class="tag is-large" x-show="verCard && listaVisitas.length">Visitas Vendedor</span>
      <table class="table noselect is-narrow is-striped" x-show="verCard && listaVisitas.length" id="table-visitas">
        <thead>
          <tr>
            <th>fecha</th>
            <th>vdor</th>
            <th>resultado</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="item in listaVisitas">
          <tr>
            <td x-text="item.fecha"></td>
            <td x-text="item.vdor"></td>
            <td x-text="item.result"></td>
          </tr>
          </template>
        </tbody>
      </table>
    </div>
   </div>
    <!-- tabla planes -->
   <div class="columns">
    <div class="column is-10">
      <span class="tag is-large" x-show="verCard && listaPlanes.length">Planes de Pago</span>
      <table class="table noselect is-narrow is-striped" x-show="verCard && listaPlanes.length" id="table-planes">
        <thead>
          <tr>
            <th>fecha</th>
            <th>cc</th>
            <th>ic</th>
            <th>p</th>
            <th>primera</th>
            <th>total</th>
            <th>saldoact</th>
            <th>user</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="item in listaPlanes">
          <tr>
            <td x-text="item.fecha"></td>
            <td x-text="item.cc"></td>
            <td class="pesos" x-text="item.ic"></td>
            <td x-text="item.p"></td>
            <td x-text="item.primera"></td>
            <td class="pesos" x-text="item.saldo"></td>
            <td class="pesos" x-text="item.saldoact"></td>
            <td x-text="item.user"></td>
          </tr>
          </template>
        </tbody>
      </table>
    </div>
   </div>
   <!-- MODALES -->
  <!-- bulma-modal edicion-pmo-vto -->
  <div class="modal" id="modal-edicion-pmovto">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Fechar PmoVto</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-edicion-pmovto')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <label for="idpmovto">PmoVto</label>
        <input type="date" class="input mb-3" x-model="Cliente.pmovto" id="idpmovto">
      </section>
      <footer class="modal-card-foot">
        <button class="button is-primary" @click="validarPmoVto">Fechar</button>
        <button class="button" @click="toggleModal('modal-edicion-pmovto')">Cancelar</button>
      </footer>
    </div>
  </div>

  <!-- bulma-modal comentarios  -->
  <div class="modal" id="modal-edicion-comentarios">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Agregar un Comentario Interno</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-edicion-comentarios')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <label for="idfecha">Fecha</label>
        <input type="date" class="input mb-3" x-model="Comentario.fechahora" id="idfecha">
        <label for="idcomentario">Comentario</label>
        <textarea class="textarea mb-3" rows="4" x-model="Comentario.comentario" id="idcomentario"></textarea>
      </section>
      <footer class="modal-card-foot">
        <button class="button is-primary" @click="guardarComentario">Guardar</button>
        <button class="button" @click="toggleModal('modal-edicion-comentarios')">Cancelar</button>
      </footer>
    </div>
  </div>

  <!-- bulma-modal edicion-cliente  -->
  <div class="modal" id="modal-edicion-cliente">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Editar datos cliente</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-edicion-cliente')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <label for="iddni">DNI</label>
        <input type="text" class="input mb-1" x-model="Cliente.dni" id="iddni"
               :class="darkTheme?'input-dark':''" required>
        <label for="idnombre">Nombre</label>
        <input type="text" class="input mb-1" x-model="Cliente.nombre" id="idnombre"
               :class="darkTheme?'input-dark':''" required>
        <label for="idcalle">Calle</label>
        <input type="text" list="listacalles" class="input mb-1" x-model="Cliente.calle" required
               id="idcalle" :class="darkTheme?'input-dark':''"  />
        <datalist id="listacalles">
          <template x-for="item in calles">
            <option :value="item"></option>
          </template>
        </datalist>
        <label for="idnum">Num</label>
        <input type="text" class="input mb-1" x-model="Cliente.num" id="idnum"
               :class="darkTheme?'input-dark':''" required>
        <label for="idbarrio">Barrio</label>
        <input type="text" list="listabarrios" class="input mb-1" x-model="Cliente.barrio" required
               id="idbarrio" :class="darkTheme?'input-dark':''" />
        <datalist id="listabarrios">
          <template x-for="item in barrios">
            <option :value="item"></option>
          </template>
        </datalist>
        <label for="idzona">Zona</label>
        <input type="text" list="listazonas" class="input mb-1" x-model="Cliente.zona" required
               id="idzona" :class="darkTheme?'input-dark':''" />
        <datalist id="listazonas">
          <template x-for="item in zonas">
            <option :value="item"></option>
          </template>
        </datalist>

        <label for="idtel">Telefono</label>
        <input type="text" class="input mb-1" x-model="Cliente.tel" id="idtel"
               :class="darkTheme?'input-dark':''" >
        <label for="idwapp">Whatsapp</label>
        <input type="text" class="input mb-1" x-model="Cliente.wapp" id="idwapp"
               :class="darkTheme?'input-dark':''" >
        <label for="idacla">Aclaracion</label>
        <input type="text" class="input mb-1" x-model="Cliente.acla" id="idacla"
               :class="darkTheme?'input-dark':''" >
        <label for="idhorario">Horario</label>
        <input type="text" class="input mb-1" x-model="Cliente.horario" id="idhorario"
               :class="darkTheme?'input-dark':''" >
        <label for="idmsg">Mensaje Cobrador</label>
        <input type="text" class="input mb-1" x-model="Cliente.mjecobr" id="idmsg"
               :class="darkTheme?'input-dark':''" >
        <label for="idseven">Info Seven</label>
        <input type="text" class="input mb-1" x-model="Cliente.infoseven" id="idseven"
               :class="darkTheme?'input-dark':''" >
      </section>
      <footer class="modal-card-foot">
        <button class="button is-primary" @click="guardarEdicion">Guardar</button>
        <button class="button" @click="toggleModal('modal-edicion-cliente')">Cancelar</button>
      </footer>
    </div>
  </div>


  <!-- bulma-modal plan-pagos  -->
  <div class="modal" id="modal-edicion-plan-pagos">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Hacer un Plan de Pagos</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-edicion-plan-pagos')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <label for="idfecha">Fecha</label>
        <input type="date" class="input mb-3" x-model="PlanPagos.fecha" id="idfecha"
               :class="darkTheme?'input-dark':''" >
        <label for="cc" class="label">Cuotas</label>
        <input type="text" class="input mb-3" x-model="PlanPagos.cc" id="cc" autocomplete="off"
               :class="darkTheme?'input-dark':''" >
        <label for="ic" class="label">Importe</label>
        <input type="text" class="input mb-3" x-model="PlanPagos.ic" id="ic" autocomplete="off"
               :class="darkTheme?'input-dark':''" >
        <label for="p" class="label">Periodicidad</label>
        <input list="per" id="p" class="input mb-3" x-model="PlanPagos.p" autocomplete="off"
               :class="darkTheme?'input-dark':''" >
        <datalist id="per">
          <option value="Mensual"></option>
          <option value="Quincenal"></option>
          <option value="Semanal"></option>
        </datalist>
        <label for="fechaprimer" class="label">Fecha Primer Cuota</label>
        <input type="date" class="input mb-3" x-model="PlanPagos.primera" id="fechaprimer"
               :class="darkTheme?'input-dark':''" >

      </section>
      <footer class="modal-card-foot">
        <button class="button is-primary" @click="validarPlanPagos">Generar</button>
        <button class="button" @click="toggleModal('modal-edicion-plan-pagos')">Cancelar</button>
      </footer>
    </div>
  </div>

  <!-- bulma-modal recibos  -->
  <div class="modal" id="modal-edicion-recibos">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Emitir Recibo por transferencia</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-edicion-recibos')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <label for="fecha" class="label">Fecha</label>
        <input type="date" class="input mb-3" x-model="Recibo.fecha" id="fecha" autocomplete="off"
               :class="darkTheme?'input-dark':''">
        <label for="cuenta" class="label">Cuenta</label>
        <input list="cuentas" id="cuenta" class="input mb-3" x-model="Recibo.cuenta" autocomplete="off"
               :class="darkTheme?'input-dark':''">
        <datalist id="cuentas">
          <template x-for="cuenta in listaCuentas">
            <option :value="cuenta"></option>
          </template>
        </datalist>
        <label for="cuota" class="label">Cuota</label>
        <input type="text" class="input mb-3" x-model="Recibo.nc" id="cuota" autocomplete="off"
               :class="darkTheme?'input-dark':''">
        <label for="ic" class="label">Importe</label>
        <input type="text" class="input mb-3" x-model="Recibo.ic" id="ic" autocomplete="off"
               :class="darkTheme?'input-dark':''">
        <label for="cobr" class="label">Cobr</label>
        <input type="text" class="input mb-3" x-model="Recibo.cobr" id="cobr" autocomplete="off"
               :class="darkTheme?'input-dark':''">
      </section>
      <footer class="modal-card-foot">
        <button class="button is-primary" @click="validarRecibo">Guardar</button>
        <button class="button" @click="toggleModal('modal-edicion-recibos')">Cancelar</button>
      </footer>
    </div>
  </div>

  <!-- bulma-modal msg-wapp  -->
  <div class="modal" id="modal-edicion-msg-wapp">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Enviar Whatsapp</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-edicion-msg-wapp')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <label for="nombre" class="label">Nombre</label>
        <input type="text" class="input mb-3" x-model="Cliente.nombre" id="nombre" autocomplete="off"
               readonly :class="darkTheme?'input-dark':''">
        <label for="direccion" class="label">Direccion</label>
        <input type="text" class="input mb-3" x-model="Cliente.direccion" id="direccion" autocomplete="off"
               readonly :class="darkTheme?'input-dark':''">
        <label for="whatsapp" class="label">WhatsApp</label>
        <input type="text" class="input mb-3" x-model="Cliente.wapp" id="whatsapp" autocomplete="off" readonly
               :class="darkTheme?'input-dark':''">
        <label for="msg" class="label">Mensaje</label>
        <textarea x-model="msgWhatsapp" id="msg" autocomplete="off" rows="10" :cols="!isMobileDevice?'62':'32'"
                  :class="darkTheme?'input-dark':''"></textarea>
      </section>
      <footer class="modal-card-foot">
        <button class="button is-primary" @click="enviarWhatsapp">Enviar</button>
        <button class="button" @click="toggleModal('modal-edicion-msg-wapp')">Cancelar</button>
      </footer>
    </div>
  </div>

  <!-- bulma-modal impr-ficha  -->
  <div class="modal" id="modal-edicion-impr-ficha">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Imprimir Ficha</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-edicion-impr-ficha')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <div class="block">
          <button class="button is-primary" @click="mostrarFichaPorPantalla=true;imprimirFichaPantalla()">Imprimir en pantalla</button>
        </div>
        <p x-text="'Cobrador asignado: '+Cliente.asignado" x-show="Cliente.deuda"></p>
        <div class="buttons">
		  <template x-for="cobr in listaCobradores">
            <button class="button" x-text="cobr" @click="cobrEnviar=cobr;imprimirFicha()" :class="cobr==Cliente.asignado?'is-danger':'is-success'"></button>
		  </template>
        </div>
      </section>
      <footer class="modal-card-foot">
        <button class="button" @click="toggleModal('modal-edicion-impr-ficha')">Cancelar</button>
      </footer>
    </div>
  </div>

  <!-- bulma-modal crear-dato  -->
  <div class="modal" id="modal-crear-dato">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <p class="modal-card-title">Crear Dato</p>
        <button class="delete" aria-label="close" @click="toggleModal('modal-crear-dato')"></button>
      </header>
      <section class="modal-card-body">
        <!-- Content ... -->
        <label for="idfecha">Fecha</label>
        <input type="date" class="input mb-3" x-model="Datos.fecha" id="idfecha"
               :class="darkTheme?'input-dark':''" >
        <label for="idfechavisitar">Fecha a Visitar (opcional)</label>
        <input type="date" class="input mb-3" x-model="Datos.fecha_visitar" id="idfechavisitar"
               :class="darkTheme?'input-dark':''" >
        <label for="art" class="label">Articulo (opcional)</label>
        <input type="text" class="input mb-3" x-model="Datos.art" id="art" autocomplete="off"
               :class="darkTheme?'input-dark':''" >
        <label for="horarios" class="label">Horarios (opcional)</label>
        <input type="text" class="input mb-3" x-model="Datos.horarios" id="horarios" autocomplete="off"
               :class="darkTheme?'input-dark':''" >
        <label for="comentarios" class="label">Comentarios (opcional)</label>
        <input type="text" class="input mb-3" x-model="Datos.comentarios" id="comentarios" autocomplete="off"
               :class="darkTheme?'input-dark':''" >
      </section>
      <footer class="modal-card-foot">
        <button class="button is-primary" @click="validarDato(Cliente.id)">Generar</button>
        <button class="button" @click="toggleModal('modal-crear-dato')">Cancelar</button>
      </footer>
    </div>
  </div>


  <!-- tabledatos -->
  <table class="table noselect is-narrow is-striped" x-show="!verCard && DatosCalle.length">
    <thead>
      <tr>
        <th>Num</th>
        <th>Nombre</th>
        <th>Deuda</th>
      </tr>
    </thead>
    <tbody>
      <template x-for="dato in DatosCalle">
        <tr :class="dato.deuda>0?(dato.atraso>45?'mora':'cliente'):'cancelado'">
          <td><button class="button is-primary is-small" x-text=dato.num @click="buscar1='';buscar=dato.dni;buscarCliente();scroll(0,0)"></button></td>
          <td x-text=dato.nombre></td>
          <td x-text=dato.deuda></td>
        </tr>
      </template>
    </tbody>
  </table>


</div>
{% endblock %}

{% block script %}
<script>
 user = {{current_user.email|tojson}}
 function main(){
     return{
         calle:'',
         calles:[],
         barrios:[],
         zonas:[],
         DatosCalle:[],
         listaClientes:[],
	     listaClientes_:[],
         listaVentas:[],
         listaCuotas:[],
         listaVentasCanceladas:[],
         listaComentarios:[],
         listaLogCambioDireccion:[],
         listaPagadas:[],
         listaCuentas:[],
         listaInflacion:{},
         listaBusquedasRecientes:[],
         listaGarantizados:[],
         listamsgs:[],
         listaDevoluciones:[],
         listaVisitas:[],
         listaPlanes:[],
         Vtos:{},
         buscar:'',
	     buscar1:'',
         verCard:false,
         intimacionWhatsapp:'',
         msgWhatsapp:'',
         ventaWapp:'',
         Cliente:{},
         Datos:{fecha:dayjs.utc().format('YYYY-MM-DD'),fecha_visitar:dayjs.utc().format('YYYY-MM-DD'), art:'', horarios:'', comentarios:''},
         cuota_basica:0,
         PlanPagos:{fecha:dayjs.utc().format('YYYY-MM-DD'),p:'Mensual'},
         Comentario:{fechahora:dayjs.utc().format('YYYY-MM-DD')},
         Asunto:{fecha:dayjs.utc().format('YYYY-MM-DD'),tipo:'',vdor:'',asunto:''},
         Recibo:{fecha:dayjs.utc().format('YYYY-MM-DD'),cuenta:''},
	     verCuotasPagadas:true,
         mostrarFichaPorPantalla:false,
         cobrEnviar:'',
         listaCobradores:[],
         wappCobrador:'',
         calleMostrada:'',
         totalCompradoActualizado:0,
         verAvisoDniCopiado:false,
         cuotaMaxima:'',

         buscarCliente(){
             this.verCard = false
             this.resetBuscar()
	         this.buscar = this.buscar1.length>0?this.buscar1:this.buscar
             let patternDni = /^(\d){7,8}$/
             /* if(patternDni.test(this.buscar)){
              *     textToClipboard(this.buscar)
              *     this.verAvisoDniCopiado=true
              *     setTimeout(()=>{this.verAvisoDniCopiado=false},3000)
              * }else{
              *     clearClipboard()
              * } */
	         if(this.buscar=='') this.buscar='-'
             axios.get('/buscador/'+this.buscar)
		          .then(res=>{
		              this.listaClientes=res.data.clientes
		              this.listaClientes_=this.listaClientes
		              this.listaClientes.map(row=>row.pmovto=dayjs.utc(row.pmovto).format('YYYY-MM-DD'))
		              this.listaClientes.map(row=>row.ultpago=dayjs.utc(row.ultpago).format('YYYY-MM-DD'))
		              this.listaClientes.map(row=>row.ultcompra=dayjs.utc(row.ultcompra).format('YYYY-MM-DD'))
		              this.listaClientes.map(row=>row.fechaintimacion=dayjs.utc(row.fechaintimacion).format('YYYY-MM-DD'))
		              /* corrijo Cliente.ultpago en los casos que ha comprado de nuevo */
		              this.listaClientes.map(row=>{
			              if(row.ultcompra>row.ultpago) row.ultpago=row.ultcompra
		              })
		              if(this.listaClientes.length==1) this.buscaCuentaporDni(res.data.clientes[0].dni)
                      this.listaBusquedasRecientes.push(this.buscar)

		          })
		          .catch(error=>{
		              msgError('Error!',error.response.data)
		          })
         },
         buscaCuentaporDni(dni){
	         this.resetBuscar()
	         this.Cliente = this.listaClientes.filter(row=>row.dni==dni)[0]
             /* axios.get('/buscador/getasignado/'+this.Cliente.zona)
              *                    .then(res=>{
              *                        this.Cliente.asignado = res.data.asignado
              * }) */
             this.Cliente.direccion = this.Cliente.calle+' '+this.Cliente.num
             this.obtenerVentas(this.Cliente.id)
             this.verCard = true;
             this.clipWappVentas()
	         this.buscar = this.Cliente.calle+' '+this.Cliente.num
             axios.get('/vendedor/getcuotamaxima/'+this.Cliente.id)
                               .then(res=>{
                                   this.cuotaMaxima = res.data.cuotamaxima
                               })
             /* console.log(this.cuotaMaxima)
              * console.log( this.Cliente) */
             if(this.Cliente.dni){
                 textToClipboard(this.Cliente.dni)
                 this.verAvisoDniCopiado=true
                 setTimeout(()=>{this.verAvisoDniCopiado=false},3000)
             }else{
                 clearClipboard()
             }
         },
         refreshCliente(dni){
             axios.get('/buscador/'+dni)
                  .then(res=>{
                      this.resetBuscar()
                      this.listaClientes=res.data.clientes
                      this.listaClientes.map(row=>row.pmovto=dayjs.utc(row.pmovto).format('YYYY-MM-DD'))
		              this.listaClientes.map(row=>row.ultpago=dayjs.utc(row.ultpago).format('YYYY-MM-DD'))
		              this.listaClientes.map(row=>row.ultcompra=dayjs.utc(row.ultcompra).format('YYYY-MM-DD'))
		              this.listaClientes.map(row=>row.fechaintimacion=dayjs.utc(row.fechaintimacion).format('YYYY-MM-DD'))
		              /* corrijo Cliente.ultpago en los casos que ha comprado de nuevo */
		              this.listaClientes.map(row=>{
			              if(row.ultcompra>row.ultpago) row.ultpago=row.ultcompra
		              })
                      this.Cliente = this.listaClientes.filter(row=>row.dni==dni)[0]
                      this.obtenerVentas(this.Cliente.id)
                      console.log( this.Cliente)
                  })
         },
	     resetBuscar(){
	         this.Cliente={}
	         this.listaClientes_=[]
	         this.listaVentas=[]
	         this.listaCuotas=[]
	         this.listaPagadas=[]
	         this.listaCuentas=[]
	         this.listaComentarios=[]
	         this.listaLogCambioDireccion=[]
             limpiarTabla('table-cuotaspagadas')
             limpiarTabla('table-cuotas')
         },
         clipWappIntimacion(){
             let text,
                 messaje;
             let direccion = this.Cliente.calle.concat(' ',this.Cliente.num)
             ultvta = this.listaVentas[0]

             let fecha = ultvta.fecha || '';
             let articulos = ultvta.art || '';
             if (this.Cliente.sev){
                 text=
                     `Nos comunicamos de la empresa ROMITEX por una deuda que usted tiene con la firma. Usted fue subido al SEVEN hasta regularizar su cuenta. Puede hacer un plan de pagos. Consulte por Wapp. Una vez cancelado en 48hs se lo elimina del SEVEN. De no desmostrar interes nos vemos obligados a cobrar su pagare por via JUDICIAL. Atte. *Departamento de cobranzas de ROMITEX*`
             } else {
                 text=
                     `Nos comunicamos de la empresa ROMITEX por una deuda que usted tiene con la firma. En los proximos dias deberemos informar al SEVEN el atraso de su cuenta. Le proponemos un plan de pagos que podemos realizar por este medio.`
             }
             messaje = this.Cliente.nombre.concat(': ',text,' ',`(Por compra de ${articulos} realizada en '${direccion}' el dia ${dayjs.utc(fecha).format('DD-MM-YYYY')})`)
             this.intimacionWhatsapp = messaje.replaceAll(' ','%20')

         },
         clipWappVentas(){
             let messajeVenta;
             messajeVenta = `${this.Cliente.nombre.toUpperCase()} Hola! Nos comunicamos de ROMITEX para informarle que en estos dias esta en su zona nuestro visitador de clientes exclusivos. Si Usted desea que ${this.Cliente.sex=="F"?'la':'lo'} visitemos SIN COMPROMISO avisenos asi le comentamos todas las promociones y articulos nuevos que tenemos para ofrecerle. Desde ya, gracias!`
             this.ventaWapp = messajeVenta.replaceAll(' ','%20')
         },
         clipDatos(idcliente){
             let text = this.Cliente.nombre+'\n'+this.Cliente.dni+'\n'+this.Cliente.calle+' '+this.Cliente.num+'\n'+this.Cliente.barrio+'\n'+this.Cliente.wapp
             textToClipboard(text)
	         msgSuccess('Exito','Datos copiados al portapapeles')
         },
         obtenerVentas(idcliente){
             axios.get('/buscador/obtenerventasporidcliente/'+idcliente)
                  .then(res=>{
                      let arrayVentas=res.data.ventas
                      arrayVentas.map(row=>{
                          row.fecha=dayjs.utc(row.fecha).format('YYYY-MM-DD')
                          if(row.p==1) row.p='MEN'
                          if(row.p==2) row.p='QUI'
                          if(row.p==3) row.p='SEM'
                          this.Vtos[row.id]=row.vto;
                      })
                      this.listaVentas = arrayVentas
                      this.listaCuentas = arrayVentas.map(row=>row.id)
                      this.listaCuotas = this.hacerCuotas()
                      this.pedirPagadas(idcliente)
                      this.obtenerVentasCanceladas(idcliente)
                      this.pedirComentarios(idcliente)
                      this.pedirLogCambioDireccion(idcliente)
                      this.pedirListaGarantizados(idcliente)
                      this.pedirListaDevoluciones(idcliente)
                      this.pedirVisitas(idcliente)
                      this.pedirPlanes(idcliente)
                      this.pedirAsignado(idcliente)
                  })
         },
         obtenerVentasCanceladas(idcliente){
             axios.get('/buscador/obtenerventascanceladasporidcliente/'+idcliente)
                  .then(res=>{
                      this.totalCompradoActualizado = 0
                      let arrayVentasCanceladas=res.data.ventascanceladas
                      arrayVentasCanceladas.map(row=>{
                          row.fecha=dayjs.utc(row.fecha).format('YYYY-MM-DD')
                          row.p=1?'MEN':3?'SEM':'QUI'
                          this.Vtos[row.id]=row.vto;
                          if(row.condonada==0&&row.devuelta==0&&row.pp==0){
                              this.totalCompradoActualizado += this.listaInflacion[dayjs(row.fecha).format('YYYYM')]*row.comprado
                          }
                      })
                      this.listaVentasCanceladas = arrayVentasCanceladas
                  })
         },
         pedirComentarios(idcliente){
             axios.get('/buscador/pedircomentarios/'+idcliente)
                  .then(res=>{
                      let arrayComentarios = res.data.comentarios
                      arrayComentarios.map(row=>row.fechahora=dayjs.utc(row.fechahora).format('YYYY-MM-DD'))
                      this.listaComentarios = arrayComentarios
                  })
         },
         pedirLogCambioDireccion(idcliente){
             axios.get('/buscador/pedirlogcambiodireccion/'+idcliente)
                  .then(res=>{
                      this.listaLogCambioDireccion = res.data.logcambiodireccion
                      this.listaLogCambioDireccion.map(row=>row.fecha=dayjs.utc(row.fecha).format('YYYY-MM-DD'))
                  })
         },
         pedirListaGarantizados(id){
             axios.get('/buscador/pedirlistagarantizados/'+id)
                  .then(res=>{
                      this.listaGarantizados = res.data.listagarantizados
                      this.listaGarantizados.map(row=>row.ultpago=dayjs.utc(row.ultpago).format('YYYY-MM-DD'))
             })
         },
         pedirListaDevoluciones(id){
             axios.get('/buscador/pedirlistadevoluciones/'+id)
                  .then(res=>{
                      this.listaDevoluciones = res.data.listadevoluciones
                      this.listaDevoluciones.map(row=>row.fechadev=dayjs.utc(row.fechadev).format('YYYY-MM-DD'))
                  })
         },
         pedirVisitas(id){
             axios.get('/buscador/pedirlistavisitas/'+id)
                  .then(res=>{
                      this.listaVisitas = res.data.listavisitas
                      //this.listaVisitas.map(row=>row.fecha=dayjs.utc(row.fecha).format('YYYY-MM-DD'))
             })
         },
         pedirPlanes(id){
             axios.get('/buscador/pedirlistaplanes/'+id)
                  .then(res=>{
                      this.listaPlanes = res.data.listaplanes
                      this.listaPlanes.map(row=>row.fecha=dayjs.utc(row.fecha).format('YYYY-MM-DD'))
                      this.listaPlanes.map(row=>row.primera=dayjs.utc(row.primera).format('YYYY-MM-DD'))
             })
         },
         pedirAsignado(id){
             axios.get('/buscador/pedirasignado/'+id)
                  .then(res=>{
                      this.Cliente.asignado = res.data.asignado
             })
         },
         hacerCuotas(){
             /* id,fecha,cc2,ic3,p4,idvdor,saldo6,comprado,pp8,devuelta,condonada,cnt,art,pagado13,primera14, */
             tblCuota=[]
             let vto
             this.listaVentas.forEach(row=>{
                 saldo = row.saldo
                 if(saldo!==0){
                     pagado = row.pagado
                     cc = row.cc
                     ic = row.ic
                     p = row.p
                     primera = row.primera
                     for (let i=1; i<=cc ;i++){
                         if(p==='MEN') vto = dayjs.utc(primera).add(i-1,'month').format('YYYY-MM-DD')
                         if(p==='QUI') vto = dayjs.utc(primera).add((i-1)*2,'week').format('YYYY-MM-DD')
                         if(p==='SEM') vto = dayjs.utc(primera).add(i-1,'week').format('YYYY-MM-DD')
                         ym = dayjs(vto).format('YYYYM')
                         index = this.listaInflacion[ym] || null
                         saldo = pagado>=ic?0:pagado<=0?ic:ic-pagado
                         saldo_actualizado = index ? parseInt(saldo * index) : saldo
                         tblCuota.push([i,vto,saldo, saldo_actualizado])
                         pagado = pagado - ic
                     }
                 }
             })
             return tblCuota
         },
         pedirPagadas(idcliente){
             axios.get('/buscador/pedirpagadasporidcliente/'+idcliente)
                  .then(res=>{
                      this.listaPagadas=res.data.pagadas
                      this.listaPagadas.map(row=>row.fecha=dayjs.utc(row.fecha).format('YYYY-MM-DD'))
	                  if(this.listaPagadas.length>5) this.verCuotasPagadas=false
                  })
         },
         toggleInc(){
             axios.get('/buscador/toggleinc/'+this.Cliente.dni)
		          .then(res=>{
		              msgSuccess('Exito',res.data.msg)
                      this.Cliente.incobrable = !this.Cliente.incobrable
		          })
         },
         toggleNvm(){
             axios.get('/buscador/togglenvm/'+this.Cliente.dni)
                  .then(res=>{
		              msgSuccess('Exito',res.data.msg)
                      this.Cliente.novendermas = !this.Cliente.novendermas
                  })
         },
         toggleSube(){
             axios.get('/buscador/togglesube/'+this.Cliente.dni)
                  .then(res=>{
		              msgSuccess('Exito',res.data.msg)
                      this.Cliente.subirseven = !this.Cliente.subirseven
                  })
         },
         toggleGestion(){
             axios.get('/buscador/togglegestion/'+this.Cliente.dni)
                  .then(res=>{
		              msgSuccess('Exito',res.data.msg)
                      this.Cliente.gestion = !this.Cliente.gestion
                  })
         },
         toggleMudo(){
             axios.get('/buscador/togglemudo/'+this.Cliente.dni)
                  .then(res=>{
		              msgSuccess('Exito',res.data.msg)
                      this.Cliente.mudo = !this.Cliente.mudo
                  })
         },
         toggleSeguir(){
             axios.get('/buscador/toggleseguir/'+this.Cliente.dni)
                  .then(res=>{
		              msgSuccess('Exito',res.data.msg)
                      this.Cliente.seguir = !this.Cliente.seguir
                  })
         },
         dialogoImprimirFicha(){
             toggleModal('modal-edicion-impr-ficha')
         },
         imprimirFicha(){
             if (this.cobrEnviar) {
		         msgDelay('Espere que se envie la ficha')
                 axios.get('/buscador/pedirwappcobrador/'+this.cobrEnviar)
                      .then(res=>{
			              this.wappCobrador = res.data.wapp
			              data = {dni:this.Cliente.dni, whatsapp:this.wappCobrador, idcliente:this.Cliente.id}
			              axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
			              axios.post("/buscador/imprimirficha", data)
									                                          .then(res=>{
                                                                                  toggleModal('modal-edicion-impr-ficha')
										                                          if(res.data.response=='success') msgSuccess('WhatsApp!','Ficha enviada al cobrador');
										                                          this.cobrEnviar = ''
									                                          })
                                                                              .catch(error=>{
                                                                                  msgError('Error','El whatsapp es invalido')
                                                                                  this.imprimirFichaPantalla()
                                                                              })
                      })
             }else{
                 this.imprimirFichaPantalla()
             }
         },
         imprimirFichaPantalla(){
             this.mostrarFichaPorPantalla = true
             data = {dni:this.Cliente.dni, whatsapp:"", idcliente:this.Cliente.id}
                 axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
		         axios.post("/buscador/imprimirfichanowapp",data, {responseType: "blob"})
								                                     .then((res)=>{
                                                                         toggleModal('modal-edicion-impr-ficha')
									                                     if (this.mostrarFichaPorPantalla) {
									                                         let url = window.URL.createObjectURL(res.data);
									                                         window.open(url);
									                                     }
									                                     this.mostrarFichaPorPantalla = false
								                                     })
         },
         intimarCliente(dni){
	         data = {dni:dni, idcliente:this.Cliente.id},
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
	         axios.post("/buscador/intimar",data,{responseType: "blob"})
								                                 .then((res) => {
								                                     let url = window.URL.createObjectURL(res.data);
								                                     window.open(url);
								                                 });
         },
         fecharPmovto(idcliente){
             if(dayjs.utc(this.Cliente.pmovto).isBefore(dayjs.utc())){
                 this.Cliente.pmovto = dayjs.utc().format('YYYY-MM-DD')
             }
             toggleModal('modal-edicion-pmovto')
         },
         validarPmoVto(){
             if(dayjs.utc(this.Cliente.pmovto).isAfter(dayjs.utc())){
                 this.guardarPmovto()
             }else{
                 msgError('La fecha debe ser posterior a hoy')
             }
         },
         guardarPmovto(){
             toggleModal('modal-edicion-pmovto')
             axios.get('/buscador/guardarpmovto/'+this.Cliente.id+'/'+this.Cliente.pmovto)
                  .then(res=>{
		              msgSuccess('Exito','Fechado realizado')
                  })
         },
         agregarComentario(){
             toggleModal('modal-edicion-comentarios')
         },
         guardarComentario(){
             toggleModal('modal-edicion-comentarios')
             this.Comentario.ingreso=user
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post('/buscador/guardarcomentario/'+this.Cliente.id,this.Comentario)
								                                 .then(res=>{
								                                     msgSuccess('Exito','Comentario agregado')
								                                     this.pedirComentarios(this.Cliente.id)
                                                                     this.Comentario={fechahora:dayjs.utc().format('YYYY-MM-DD')}
								                                 })
         },
         editarCliente(idcliente){
             toggleModal('modal-edicion-cliente')
         },
         guardarEdicion(){
             toggleModal('modal-edicion-cliente')
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post('/buscador/guardaredicioncliente/'+this.Cliente.id,this.Cliente)
								                                 .then(res=>{
								                                     msgSuccess('Exito','Cliente editado con exito')
                                                                     this.refreshCliente(this.Cliente.dni)
								                                 })
								                                 .catch(error=>{
								                                     msgError('Error',error.request.response)
								                                 })
         },
         obtenerCalles(){
             axios.get('/buscador/obtenerlistacalles')
                  .then(res=>{
                      this.calles = res.data.result
                  })
         },
         obtenerBarrios(){
             axios.get('/buscador/obtenerlistabarrios')
                  .then(res=>{
                      this.barrios = res.data.result
                  })
         },
         obtenerZonas(){
             axios.get('/buscador/obtenerlistazonas')
                  .then(res=>{
                      this.zonas = res.data.result
                  })
         },
         obtenerCobradores(){
             axios.get('/buscador/obtenercobradores')
                  .then(res=>{
                      this.listaCobradores = res.data.cobradores
                  })
         },
         agregarPlanPago(){
             toggleModal('modal-edicion-plan-pagos')
         },
         validarPlanPagos(){
             if(this.validarListVar([this.PlanPagos.primera,this.PlanPagos.fecha,this.PlanPagos.cc,this.PlanPagos.ic,this.PlanPagos.p])){
                 this.guardarPlanPagos()
             }else{
                 msgError('Complete los datos faltantes')
           }
         },
         guardarPlanPagos(){
             this.PlanPagos.p = this.PlanPagos.p=="Mensual"?1:this.PlanPagos.p=="Quincenal"?2:3
             this.PlanPagos.idcliente = this.Cliente.id
             toggleModal('modal-edicion-plan-pagos')
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post('/buscador/generarplandepagos',this.PlanPagos)
								                                 .then(res=>{
								                                     msgSuccess('Exito','Plan de pagos generado')
								                                     this.refreshCliente(this.Cliente.dni)
                                                                     this.PlanPagos={fecha:dayjs.utc().format('YYYY-MM-DD'),p:'Mensual'}
								                                 })
								                                 .catch(error=>{
								                                     msgError('Hubo un error y el plan de pagos no se genero')
								                                 })

         },
         emitirLibreDeuda(dni){
	         data= {dni:dni, wapp:this.Cliente.wapp, idcliente:this.Cliente.id, deuda:this.Cliente.deuda},
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             if(this.Cliente.wapp && this.Cliente.deuda<=0){
		         msgDelay('Espere se esta enviando el libredeuda')
		         axios.post("/buscador/libredeuda",data)
		              .then((res) => {
			              switch(res.data){
			                  case 'success': {
				                  msgSuccess('Exito!','Mensaje Enviado')
				                  break
			                  }
			                  case 'invalid': {
				                  msgError('Error!','Whatsapp INVALIDO')
				                  this.obtenerWappCliente()
                                  this.emitirLibredeudaNoWapp()
				                  break
			                  }
			                  case 'failed': {
				                  msgError('Error!','Mensaje no enviado - Failed')
                                  this.emitirLibredeudaNoWapp()
				                  break
			                  }
			              }
		              })
                      .catch(error=>{
                          msgError('Error!','Whatsapp INVALIDO')
                          this.emitirLibredeudaNoWapp()
                      })
	         }else{
		         this.emitirLibredeudaNoWapp()
             }
	     },
         emitirLibredeudaNoWapp(){
             console.log( "llamado a libredeudanowapp")
             data= this.Cliente
             axios.post('/buscador/libredeuda/nowapp',data,{responseType:"blob"})
		          .then(res=>{
			              let url = window.URL.createObjectURL(res.data);
			              window.open(url);
			              if (this.Cliente.wapp && this.Cliente.deuda>0) {
			                  msgSuccess("Whatsapp!","No se envio el whatsapp porque todavia tiene deuda")}
		              })
         },
         emitirRbo(){
	         if(this.Cliente.deuda==0){msgError('Error!','El cliente no tiene deuda');return}
             toggleModal('modal-edicion-recibos')
             this.Recibo.cuenta = ''
             this.Recibo.nc = ''
             this.Recibo.ic = ''
             this.Recibo.cobr = ''
         },
         validarRecibo(){
             if(!this.listaCuentas.includes(Number(this.Recibo.cuenta))){
                 msgError('El NÂº de cuenta no corresponde al cliente')
                 return}
             this.guardarRecibo()
         },
         guardarRecibo(){
             this.Recibo.idcliente = this.Cliente.id
             this.Recibo.wapp = this.Cliente.wapp
             toggleModal('modal-edicion-recibos')
             if (!this.listaCuentas.includes(parseInt(this.Recibo.cuenta))) {msgError('Error!','Numero de cuenta NO existe');return}
	         msgDelay('Espere mientras se envia el Recibo')
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post('/buscador/generarrbotransferencia',this.Recibo)
								                                 .then(res=>{
                                                                     this.refreshCliente(this.Cliente.dni)
								                                     this.Recibo.rbo = res.data.rbo
								                                     if(this.Cliente.wapp){
									                                     axios.post('/buscador/enviarrbotransferencia',this.Recibo)
									                                          .then(res=>{
										                                          switch(res.data.response){
										                                              case 'success': {
											                                              msgSuccess('Exito!','Recibo Enviado')
											                                              break
										                                              }
										                                              case 'invalid': {
											                                              msgError('Error!','Whatsapp INVALIDO')
											                                              this.obtenerWappCliente()
                                                                                          this.enviarRboTransferenciaNoWapp()
											                                              break
										                                              }
										                                              case 'failed': {
											                                              msgError('Error!','Recibo no enviado - Failed')
                                                                                          this.enviarRboTransferenciaNoWapp()
											                                              break
										                                              }
										                                          }
										                                          this.Recibo = {fecha:dayjs.utc().format('YYYY-MM-DD')}

									                                          })
									                                          .catch(error=>{
                                                                                  msgError('Error!','no se pudo enviar el Recibo, pero esta procesado.',10000)
                                                                                  this.enviarRboTransferenciaNoWapp()


								                                              })
                                                                     }else{
									                                     this.enviarRboTransferenciaNoWapp()
								                                     }
								                                 })
								                                 .catch(error=>msgError('Error!','El recibo no se genero'))
         },
         enviarRboTransferenciaNoWapp(){
             console.log( "enviando rbo transf nowapp en pantalla")
              axios.post('/buscador/enviarrbotransferencia/nowapp',this.Recibo,{responseType:"blob"})
									                                          .then(res=>{
										                                          let url = window.URL.createObjectURL(res.data);
										                                          window.open(url);
									                                          })
         },
         sendMsgVenta(wapp){
	         msgDelay('Espere mientras se envia el Whatsapp')
	         data = {idcliente:this.Cliente.id,
		             wapp:this.Cliente.wapp,
		             msg:this.ventaWapp,
	         }
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post('/buscador/wapp',data)
								                                 .then(res=>{
								                                     switch(res.data){
									                                     case 'success': {
									                                         msgSuccess('Exito!','Mensaje Enviado')
									                                         break
									                                     }
									                                     case 'invalid': {
									                                         msgError('Error!','Whatsapp INVALIDO')
									                                         this.obtenerWappCliente()
									                                         break
									                                     }
									                                     case 'failed': {
									                                         msgError('Error!','Mensaje no enviado - Failed')
									                                         break
									                                     }
								                                     }
								                                 })
								                                 .catch(error=>msgError('Error','Mensaje no enviado'))
         },
         sendIntWhatsapp(){
	         msgDelay('Espere mientras se envia la intimacion')
             this.clipWappIntimacion()
	         data = {idcliente:this.Cliente.id,
		             wapp:this.Cliente.wapp,
		             msg:this.intimacionWhatsapp,
	         }
             if(!this.Cliente.deuda) msgError('Error!','Cliente SIN deuda')
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post('/buscador/wapp', data)
								                                 .then(res=>{
								                                     switch(res.data){
									                                     case 'success': {
									                                         msgSuccess('Exito!','Mensaje Enviado')
									                                         break
									                                     }
									                                     case 'invalid': {
									                                         msgError('Error!','Whatsapp INVALIDO')
									                                         this.obtenerWappCliente()
									                                         break
									                                     }
									                                     case 'failed': {
									                                         msgError('Error!','Mensaje no enviado - Failed')
									                                         break
									                                     }
								                                     }
								                                 })
								                                 .catch(error=>msgError('Error!','Mensaje NO enviado'))
         },
         sendIntimacion(dni, wapp){
	         msgDelay('Espere mientras se envia la intimacion')
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post("/buscador/intimar",this.Cliente)
								                                 .then(res=>{
								                                     if(wapp){
									                                     switch(res.data.response){
									                                         case 'success': {
										                                         msgSuccess('Exito!','Mensaje Enviado')
										                                         break
									                                         }
									                                         case 'invalid': {
										                                         msgError('Error!','Whatsapp INVALIDO')
										                                         this.obtenerWappCliente()
                                                                                 this.intimarClienteNoWapp()
										                                         break
									                                         }
									                                         case 'failed': {
										                                         msgError('Error!','Mensaje no enviado - Failed')
                                                                                 this.intimarClienteNoWapp()
										                                         break
									                                         }
									                                     }
								                                     }else{
                                                                         this.intimarClienteNoWapp()
								                                     }
								                                 })
         },
         intimarClienteNoWapp(){
              axios.get('/buscador/intimar/nowapp/'+this.Cliente.dni,{responseType:"blob"})
									                                          .then(res=>{
										                                          let url = window.URL.createObjectURL(res.data);
										                                          window.open(url);
										                                          msgSuccess('Exito!','Intimacion impresa en pantalla')
									                                          })
         },
         sendMsgGeneral(){
             toggleModal('modal-edicion-msg-wapp')
         },
         enviarWhatsapp(){
	         data= {idcliente:this.Cliente.id,
		            wapp:this.Cliente.wapp,
		            msg:this.msgWhatsapp,
	         }
             toggleModal('modal-edicion-msg-wapp')
	         msgDelay('Espere mientras se envia el mensaje')
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
	         axios.post('/buscador/wapp',data)
								                                 .then(res=>{
								                                     switch(res.data){
									                                     case 'success': {
									                                         msgSuccess('Exito!','Mensaje Enviado')
									                                         break
									                                     }
									                                     case 'invalid': {
									                                         msgError('Error!','Whatsapp INVALIDO')
									                                         this.obtenerWappCliente()
									                                         break
									                                     }
									                                     case 'failed': {
									                                         msgError('Error!','Mensaje no enviado - Failed')
									                                         break
									                                     }
								                                     }
								                                 })
								                                 .catch(error=>msgError('Error!','Mensaje no enviado'))
         },
         sendMsgRecordatorio(){
	         msgDelay('Espere mientras se envia el recordatorio')
             msgRecordatorio = (this.Cliente.sex='M'?"Estimado ":"Estimada ")+this.Cliente.nombre.toUpperCase()+": Buenos dias, le escribimos de ROMITEX para recordarle el vencimiento de su cuota. Le pedimos que nos envie por este medio el comprobante de la transferencia, asi le enviamos el recibo correspondiente. Gracias!"
	         data = {idcliente:this.Cliente.id,
		             wapp:this.Cliente.wapp,
		             msg:msgRecordatorio,
	         }
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
	         axios.post('/buscador/wapp',data)
								                                 .then(res=>{
								                                     switch(res.data){
									                                     case 'success': {
									                                         msgSuccess('Exito!','Mensaje Enviado')
									                                         break
									                                     }
									                                     case 'invalid': {
									                                         msgError('Error!','Whatsapp INVALIDO')
									                                         this.obtenerWappCliente()
									                                         break
									                                     }
									                                     case 'failed': {
									                                         msgError('Error!','Mensaje no enviado - Failed')
									                                         break
									                                     }
								                                     }
								                                 })
								                                 .catch(error=>msgError('Error!','Mensaje no Enviado'))
         },
         sendMsgCbu(){
	         msgDelay('Espere mientras se envian los datos')
             msgCbu = `DATOS DE LA CUENTA:
NÃºmero de CBU: 0170084840000048757878
Alias de CBU: ROMITEX
Titular de la cuenta: SALVAY SERGIO FEDERICO`
		              data = {idcliente:this.Cliente.id,
			                  wapp:this.Cliente.wapp,
			                  msg:msgCbu,
		              }
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
	         axios.post('/buscador/wapp',data)
								                                 .then(res=>{
								                                     switch(res.data){
									                                     case 'success': {
									                                         msgSuccess('Exito!','Mensaje Enviado')
									                                         break
									                                     }
									                                     case 'invalid': {
									                                         msgError('Error!','Whatsapp INVALIDO')
									                                         this.obtenerWappCliente()
									                                         break
									                                     }
									                                     case 'failed': {
									                                         msgError('Error!','Mensaje no enviado - Failed')
									                                         break
									                                     }
								                                     }
								                                 })
								                                 .catch(error=>msgError('Error!','Mensaje NO enviado'))
	     },
	     obtenerWappCliente(){
	         axios.get('/ventas/obtenerwappcliente/'+this.Cliente.id)
		          .then(res=>{
		              this.Cliente.wapp = res.data.wapp
	     })},
	     condonarVenta(id){
	         axios.get('/ventas/condonar/'+id)
		          .then(res=>{
		              this.buscarCliente(this.Cliente.dni)			 })
	     },
	     hacerLlamada(tel){
	         re = /[0-9]*/
	         tel = re.exec(tel)[0]
	         window.location.href = 'tel:' + tel;
	     },
	     mostrarCalle(){
	         axios.get('/buscador/mostrarcalle/'+this.calleMostrada)
		          .then(res=>{
		              this.verCard = false
		              this.DatosCalle = res.data.calle
		          })
	     },
	     gestionarBajaSeven(){
	         msg = `Buen dÃ­a, te enviamos los siguientes datos para gestionar BAJA POR CANCELACIÃN, gracias!\nNombre ${this.Cliente.nombre}\nDNI ${this.Cliente.dni}\nDirecciÃ³n ${this.Cliente.calle} ${this.Cliente.num}\n\nROMITEX - Sergio Federico Salvay`
	         data = {idcliente: this.Cliente.id,
		             wapp: '3513007412',
		             msg:msg,
	         }
	         if(this.Cliente.deuda>0) {msgError('Error','El cliente tiene deuda');return}
	         if(this.Cliente.sev!=1) {msgError('Error', 'El cliente NO esta en el seven');return}
	         axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
	         axios.post('/buscador/wapp', data)
								                                 .then(res=>{
								                                     msgSuccess('WhatsApp','Mensaje Enviado')
								                                     this.sev = 0
								                                     this.baja = dayjs.utc().format('YYYY-MM-DD')
								                                     axios.get('/buscador/bajaindividualseven/'+this.Cliente.id)
										                                              .then(res=>{
											                                              this.Cliente.sev = res.data.cliente[0].sev
											                                              this.Cliente.baja = res.data.cliente[0].baja
										                                              })
								                                 })
								                                 .catch(error=>msgError('Error','Mensaje no enviado'))
	     },
         getInflacion(){
             axios.get('/buscador/tablainflacion')
                  .then(res=>{
                      this.listaInflacion = res.data.inflacion
         })},
          sendMsgProgramado(nombre){
              msg = this.listamsgs.filter(row=>row.nombre==nombre)[0].msg
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
              data={
                  idcliente:this.Cliente.id,
                  wapp:this.Cliente.wapp,
                  msg:msg,
              }
             axios.post('/buscador/wapp',data)
                                                                 .then(res=>{
                                                                     msgSuccess('Exito','Mensaje Enviado')
                                                                 })
          },
         cargarMsgs(){
             axios.get('/fichas/getmsgs')
                  .then(res=>{
                      this.listamsgs = res.data.msgs
	              })
         },
         autoLoad(){
             {% if dnilistado %}
             if(this.buscar=='') this.buscar = {{dnilistado|tojson}}
             this.buscarCliente()
             {% endif %}
         },
         validarListVar(list){
             for(item of list){
                 if(typeof item === "undefined") return false;
                 if(item=='') return false;
             }
             return true;
         },
         crearDato(){
             toggleModal("modal-crear-dato")
             this.Datos = {fecha:dayjs.utc().format('YYYY-MM-DD'),fecha_visitar:dayjs.utc().format('YYYY-MM-DD'), art:'', horarios:'', comentarios:''}
         },
         validarDato(idcliente){
             if(this.cuota_basica==0){
                 axios.get('/vendedor/getcuotabasica')
                      .then(res=>{
                          this.cuota_basica=res.data.cuotabasica
                 })
             }
             axios.get('/vendedor/verificarqueyaesdato/'+idcliente)
                  .then(res=>{
                      this.guardarDato()
                  })
                  .catch(error=>{
                      msgError('Este cliente ya tiene un dato vigente')
                      toggleModal("modal-crear-dato")
             })
         },
         guardarDato(){
             toggleModal("modal-crear-dato")
             this.Datos.user = user
             this.Datos.cuota_maxima = this.cuota_basica
             this.Datos.idcliente = this.Cliente.id
             axios.defaults.headers.common['X-CSRF-TOKEN'] = this.$refs.token.value
             axios.post('/vendedor/guardardato',this.Datos)
                                                                 .then(res=>{
                                                                     msgSuccess('El dato ha sido registrado con exito')
                                                                 })
                                                                 .catch(error=>{
                                                                     msgError('Hubo un error el dato no se registro')
                                                                 })

         },
         borrarComentario(id,idcliente){
             Swal.fire({
                 title: 'Â¿Esta seguro?',
                 text: `Afecta al comentario ${id}`,
                 icon: 'warning',
                 showCancelButton: true,
                 confirmButtonColor: '#3085d6',
                 cancelButtonColor: '#d33',
                 confirmButtonText: 'Si, borrarlo!'
             }).then((result) => {
                 if (result.isConfirmed) {
                     axios.get('/buscador/deletecomentario/'+id)
                          .then(res=>{
                              msgSuccess('Borrado!','El comentario ha sido borrado')
                              this.pedirComentarios(idcliente)
                          })
             }})
         },
     }
 }
</script>
{% endblock %}
